<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Veterinário - Login</title>
    <style>
        /* (todo o CSS permanece exatamente igual) */
        
        /* ========== ADIÇÃO: Animações para transição suave ========== */
        .fade-out {
            animation: fadeOut 0.5s ease forwards;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <div class="logo-image">
                <img src="2-rcg-926x926 (1).jpg" alt="Logo Veterinária">
            </div>
            <h1>Vet 2°rcg System</h1>
            <p>Sistema de Gestão Veterinária</p>
        </div>
        
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label for="role">Cargo</label>
                <select id="role" required>
                    <option value="">Selecione seu cargo</option>
                    <option value="admin">Administrador (Ten)</option>
                    <option value="moderador">Moderador (Aux, Enf)</option>
                    <option value="visitante">Visitante (Estagiário)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="username">Usuário</label>
                <input type="text" id="username" placeholder="Digite seu usuário" required>
                <select id="adminUsers" style="display: none; margin-top: 10px;">
                    <option value="">Selecione um administrador</option>
                    <option value="Maj. Cristovam">Maj. Cristovam</option>
                    <option value="Ten. Henrique">Ten. Henrique</option>
                    <option value="Ten. Thayanne">Ten. Espinho</option>
                    <option value="Ten. Thayanne">Ten. Aragon</option>
                    <option value="Ten. Andressa">Ten. Andressa</option>
                    <option value="Ten. Espinho">Ten. Thayanne</option>
                </select>
                <select id="moderadorUsers" style="display: none; margin-top: 10px;">
                    <option value="">Selecione um moderador</option>
                    <option value="CB Bittencourt">CB Bittencourt</option>
                    <option value="CB De Lima">CB De Lima</option>
                    <option value="SD Vergílio">SD Vergílio</option>
                    <option value="SD Cardoso">SD Cardoso</option>
                    <option value="SD André Vitoria">SD André Vitoria</option>
                    <option value="SD Luiz Furtado">SD Luiz Furtado</option>
                    <option value="SD Martins Silva">SD Martins Silva</option>
                    <option value="SD Silva">SD Silva</option>
                    <option value="SD Luiz">SD Luiz</option>
                    <option value="SD Silva Custodio">SD Silva Custodio</option>
                    <option value="SD Humberto Neto">SD Humberto Neto</option>
                    <option value="SD Aquiles">SD Aquiles</option>
                    <option value="SD Martins Ramos">SD Martins Ramos</option>
                    <option value="SD Andrade Magalhães">SD Andrade Magalhães</option>
                    <option value="SD Nicollas Duarte">SD Nicollas Duarte</option>
                    <option value="SD Lucena">SD Lucena</option>
                    <option value="SD João Pedrosa">SD João Pedrosa</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="password">Senha</label>
                <div class="password-container">
                    <input type="password" id="password" placeholder="Digite a senha do seu cargo" required>
                    <button type="button" class="toggle-password" id="togglePassword">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="password-hint" id="passwordHint"></div>
            </div>
            
            <button type="submit" class="btn-login">Entrar no Sistema</button>
            
            <div class="error-message" id="errorMessage">
                Senha incorreta para este cargo. Tente novamente.
            </div>
            
            <div class="success-message" id="successMessage">
                Login realizado com sucesso! Redirecionando...
            </div>
        </form>
        
        <div class="permissions-info">
            <h3>Permissões do Sistema</h3>
            <ul>
                <li><strong>Administrador (Ten):</strong> Acesso total ao sistema</li>
                <li><strong>Moderador (Aux, Enf):</strong> Acesso a fichas e registros entretanto não consegue editar fichas e nem criar. Somente editar e criar caderno de visitas.</li>
                <li><strong>Visitante (Estagiário):</strong> Acesso limitado para consulta. Não tem acesso para editar nada, somente olhar.</li>
            </ul>
            <p style="margin-top: 10px; font-size: 12px; color: #666;">
                <strong>Nota:</strong> Tentativas de alteração não permitidas exibirão uma mensagem de erro.
            </p>
        </div>
        
        <div class="footer">
            &copy; 2025 Vet2°rcg System - Todos os direitos reservados
        </div>
    </div>

    <script>
        // ========== CONFIGURAÇÕES DE LOGIN ==========
        // Senhas para cada tipo de permissão
        const passwords = {
            'admin': 'admin123',
            'moderador': 'mod456',
            'visitante': 'estag789'
        };
        
        // Dicas de senha para cada cargo
        const passwordHints = {
            'admin': 'Use a senha do Administrador (admin123)',
            'moderador': 'Use a senha do Moderador (mod456)',
            'visitante': 'Use a senha do Visitante (estag789)'
        };
        
        // ========== ELEMENTOS DO DOM ==========
        const roleSelect = document.getElementById('role');
        const usernameInput = document.getElementById('username');
        const adminUsersSelect = document.getElementById('adminUsers');
        const moderadorUsersSelect = document.getElementById('moderadorUsers');
        const passwordInput = document.getElementById('password');
        const passwordHint = document.getElementById('passwordHint');
        const togglePassword = document.getElementById('togglePassword');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const loginForm = document.getElementById('loginForm');
        const loginContainer = document.querySelector('.login-container');
        
        // ========== FUNÇÕES DE LOGIN ==========
        // Alternar entre input de texto e selects para administradores/moderadores
        roleSelect.addEventListener('change', function() {
            const selectedRole = this.value;
            
            // Limpar mensagens de erro/sucesso
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Atualizar dica de senha
            if (selectedRole && passwordHints[selectedRole]) {
                passwordHint.textContent = passwordHints[selectedRole];
            } else {
                passwordHint.textContent = '';
            }
            
            // Resetar todos os selects e inputs
            usernameInput.style.display = 'block';
            usernameInput.required = true;
            adminUsersSelect.style.display = 'none';
            adminUsersSelect.required = false;
            moderadorUsersSelect.style.display = 'none';
            moderadorUsersSelect.required = false;
            usernameInput.value = '';
            adminUsersSelect.value = '';
            moderadorUsersSelect.value = '';
            
            // Mostrar o select apropriado baseado no cargo
            if (selectedRole === 'admin') {
                usernameInput.style.display = 'none';
                adminUsersSelect.style.display = 'block';
                adminUsersSelect.required = true;
                usernameInput.required = false;
            } else if (selectedRole === 'moderador') {
                usernameInput.style.display = 'none';
                moderadorUsersSelect.style.display = 'block';
                moderadorUsersSelect.required = true;
                usernameInput.required = false;
            }
        });
        
        // Preencher automaticamente o campo de usuário quando selecionar um administrador
        adminUsersSelect.addEventListener('change', function() {
            if (this.value) {
                usernameInput.value = this.value;
            }
        });
        
        // Preencher automaticamente o campo de usuário quando selecionar um moderador
        moderadorUsersSelect.addEventListener('change', function() {
            if (this.value) {
                usernameInput.value = this.value;
            }
        });
        
        // Alternar visibilidade da senha
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Alterar ícone do olho
            if (type === 'text') {
                this.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.68192 3.96914 7.65663 6.06 6.06006M9.9 4.24006C10.5883 4.0789 11.2931 3.99836 12 4.00006C19 4.00006 23 12 23 12C22.393 13.1356 21.6691 14.2048 20.84 15.19M14.12 14.12C13.8454 14.4148 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.572 9.14351 13.1984C8.99262 12.8249 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2219 9.18488 10.8539C9.34884 10.4859 9.58525 10.1547 9.88 9.88006" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `;
            } else {
                this.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `;
            }
        });
        
        // Processar o formulário de login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const role = document.getElementById('role').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validar se todos os campos foram preenchidos
            if (!role) {
                errorMessage.textContent = 'Por favor, selecione um cargo.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            if (!username) {
                errorMessage.textContent = 'Por favor, preencha o usuário.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            if (!password) {
                errorMessage.textContent = 'Por favor, preencha a senha.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            // Verificar se a senha está correta para o cargo selecionado
            if (password === passwords[role]) {
                // Login bem-sucedido
                errorMessage.style.display = 'none';
                successMessage.style.display = 'block';
                
                // ========== SALVAR PERMISSÕES DO USUÁRIO ==========
                // Salvar informações do usuário no localStorage
                localStorage.setItem('currentUser', username);
                localStorage.setItem('userRole', role);
                localStorage.setItem('loginTime', new Date().toISOString());
                
                // Definir permissões baseadas no cargo
                let permissions = {
                    canEditFichas: false,
                    canCreateFichas: false,
                    canDeleteFichas: false,
                    canCreateCadernoVisitas: false,
                    canEditCadernoVisitas: false,
                    canViewAll: false,
                    roleName: ''
                };
                
                if (role === 'admin') {
                    permissions = {
                        canEditFichas: true,
                        canCreateFichas: true,
                        canDeleteFichas: true,
                        canCreateCadernoVisitas: true,
                        canEditCadernoVisitas: true,
                        canViewAll: true,
                        roleName: 'Administrador (Ten)'
                    };
                } else if (role === 'moderador') {
                    permissions = {
                        canEditFichas: false,
                        canCreateFichas: false,
                        canDeleteFichas: false,
                        canCreateCadernoVisitas: true,
                        canEditCadernoVisitas: true,
                        canViewAll: true,
                        roleName: 'Moderador (Aux, Enf)'
                    };
                } else if (role === 'visitante') {
                    permissions = {
                        canEditFichas: false,
                        canCreateFichas: false,
                        canDeleteFichas: false,
                        canCreateCadernoVisitas: false,
                        canEditCadernoVisitas: false,
                        canViewAll: true,  // Pode visualizar, mas não editar
                        roleName: 'Visitante (Estagiário)'
                    };
                }
                
                // Salvar permissões no localStorage
                localStorage.setItem('userPermissions', JSON.stringify(permissions));
                
                // Adicionar efeito visual de saída
                if (loginContainer) {
                    loginContainer.classList.add('fade-out');
                }
                
                // Redirecionar para a tela do sistema após 1 segundo
                setTimeout(function() {
                    window.location.href = 'sistema.html';
                }, 800);
            } else {
                // Senha incorreta
                errorMessage.textContent = 'Senha incorreta para este cargo. Tente novamente.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                
                // Efeito visual para erro
                loginForm.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    loginForm.style.animation = '';
                }, 500);
            }
        });
        
        // Limpar mensagens quando o usuário começar a digitar
        document.getElementById('username').addEventListener('input', function() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        });
        
        document.getElementById('password').addEventListener('input', function() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        });
        
        // Adicionar animação de shake para erros
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // ========== FUNÇÕES GLOBAIS PARA CONTROLE DE PERMISSÕES ==========
        
        // Função para mostrar alerta de permissão (será usada em outras páginas)
        window.showPermissionAlert = function(message, type = 'error') {
            // Remover alertas anteriores
            const existingAlerts = document.querySelectorAll('.permission-alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `permission-alert ${type}`;
            alertDiv.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 9V11M12 15H12.01M5.07183 19H18.9282C20.4678 19 21.4301 17.3333 20.6603 16L13.7321 4C12.9623 2.66667 11.0378 2.66667 10.268 4L3.33978 16C2.56998 17.3333 3.53223 19 5.07183 19Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>${message}</span>
                <button class="permission-alert-close">&times;</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            alertDiv.querySelector('.permission-alert-close').addEventListener('click', () => {
                alertDiv.remove();
            });
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.remove();
                        }
                    }, 300);
                }
            }, 5000);
        };
        
        // Função para verificar permissões (será usada em outras páginas)
        window.checkUserPermissions = function() {
            const userRole = localStorage.getItem('userRole');
            const permissions = JSON.parse(localStorage.getItem('userPermissions') || '{}');
            const loginTime = localStorage.getItem('loginTime');
            
            // Verificar se o login é válido (menos de 8 horas)
            if (loginTime) {
                const loginDate = new Date(loginTime);
                const now = new Date();
                const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
                
                if (hoursDiff > 8) {
                    // Login expirado
                    localStorage.clear();
                    window.location.href = 'login.html';
                    return null;
                }
            }
            
            if (!userRole || !permissions) {
                window.location.href = 'login.html';
                return null;
            }
            
            return { 
                role: userRole, 
                permissions: permissions,
                username: localStorage.getItem('currentUser')
            };
        };
        
        // Função para verificar permissão específica
        window.hasPermission = function(permissionName) {
            const userData = window.checkUserPermissions();
            if (!userData) return false;
            
            return userData.permissions[permissionName] || false;
        };
        
        // Função para bloquear ação se não tiver permissão
        window.blockIfNoPermission = function(permissionName, actionName) {
            if (!window.hasPermission(permissionName)) {
                window.showPermissionAlert(
                    `Você não possui permissão para ${actionName}. Contate um administrador.`,
                    'error'
                );
                return true; // Bloqueado
            }
            return false; // Permissão concedida
        };
        
        // Função para obter nome do cargo formatado
        window.getUserRoleName = function() {
            const userData = window.checkUserPermissions();
            return userData ? userData.permissions.roleName : 'Não autenticado';
        };
        
        // Verificar se já está logado ao carregar a página
        window.addEventListener('load', function() {
            const userRole = localStorage.getItem('userRole');
            if (userRole && window.location.pathname.includes('login.html')) {
                // Se já estiver logado, redirecionar para o sistema
                setTimeout(() => {
                    window.location.href = 'sistema.html';
                }, 500);
            }
        });
    </script>
</body>
</html>
