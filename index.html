<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Veterinário</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ESTILOS DA TELA DE LOGIN */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #2c7fb8, #7fcdbb);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .logo-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background-color: #f0f8ff;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #2c7fb8;
            overflow: hidden;
        }
        
        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo h1 {
            color: #2c7fb8;
            font-size: 26px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo p {
            color: #666;
            font-size: 15px;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2c7fb8;
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 127, 184, 0.2);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }
        
        .toggle-password:hover {
            color: #2c7fb8;
        }
        
        .btn-login {
            background: linear-gradient(to right, #2c7fb8, #7fcdbb);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(44, 127, 184, 0.3);
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(44, 127, 184, 0.4);
        }
        
        .permissions-info {
            margin-top: 25px;
            padding: 18px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            border-left: 4px solid #2c7fb8;
        }
        
        .permissions-info h3 {
            color: #2c7fb8;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .permissions-info ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .permissions-info li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        
        .permissions-info li:before {
            content: "•";
            color: #2c7fb8;
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
            padding: 10px;
            background-color: #ffeaea;
            border-radius: 5px;
        }
        
        .success-message {
            color: #27ae60;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
            padding: 10px;
            background-color: #eafaf1;
            border-radius: 5px;
        }
        
        .password-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #888;
            font-size: 12px;
        }
        
        /* TELA DE TRANSIÇÃO */
        #welcomePage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c7fb8 0%, #7fcdbb 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        .welcome-container {
            max-width: 600px;
            padding: 40px;
            animation: fadeInUp 1s ease-out;
        }
        
        .welcome-logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .welcome-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .welcome-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease 0.5s forwards;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .welcome-subtitle {
            font-size: 1.8rem;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 0.8s ease 1s forwards;
            font-weight: 300;
        }
        
        .welcome-user {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 0.8s ease 1.5s forwards;
            color: #ffeb3b;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .loading-bar {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 30px auto;
            opacity: 0;
            animation: fadeIn 0.8s ease 2s forwards;
        }
        
        .loading-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            border-radius: 10px;
            animation: loading 2.5s ease 2.2s forwards;
        }
        
        .welcome-message {
            font-size: 1.2rem;
            opacity: 0;
            animation: fadeIn 0.8s ease 2.5s forwards;
            margin-top: 20px;
            font-weight: 300;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes loading {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }
        
        /* ESTILOS DA TELA DE ARQUIVOS */
        #filesPage {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.8s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2c7fb8;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-image-small {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #2c7fb8;
            overflow: hidden;
        }
        
        .logo-image-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text h1 {
            color: #2c7fb8;
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: #666;
            font-size: 14px;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-info span {
            color: #2c7fb8;
            font-weight: 600;
        }
        
        .btn-logout {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-logout:hover {
            background: #c0392b;
        }
        
        .main-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-title {
            color: #2c7fb8;
            margin-bottom: 25px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-title svg {
            width: 30px;
            height: 30px;
        }
        
        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px 15px;
            width: 300px;
        }
        
        .search-box input {
            border: none;
            background: transparent;
            padding: 8px;
            width: 100%;
            outline: none;
        }
        
        .search-box svg {
            color: #666;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2c7fb8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d5f8a;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #7fcdbb;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5bbfa5;
            transform: translateY(-2px);
        }
        
        .btn-visita {
            background: #9b59b6;
            color: white;
        }
        
        .btn-visita:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .alphabet-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .letter-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: white;
            color: #2c7fb8;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .letter-btn:hover, .letter-btn.active {
            background: #2c7fb8;
            color: white;
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .file-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #2c7fb8;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .horse-name {
            color: #2c7fb8;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .horse-details {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .horse-details div {
            margin-bottom: 5px;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        
        .btn-edit:hover {
            background: #e67e22;
        }
        
        .btn-pdf {
            background: #e74c3c;
            color: white;
        }
        
        .btn-pdf:hover {
            background: #c0392b;
        }
        
        .btn-visita-small {
            background: #9b59b6;
            color: white;
        }
        
        .btn-visita-small:hover {
            background: #8e44ad;
        }
        
        .btn-delete-small {
            background: #e74c3c;
            color: white;
        }
        
        .btn-delete-small:hover {
            background: #c0392b;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        /* NOVOS ESTILOS PARA ESQUADRÃO */
        .esquadrao-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .esquadrao-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .esquadrao-option:hover {
            border-color: #2c7fb8;
        }
        
        .esquadrao-option.selected {
            background-color: #2c7fb8;
            color: white;
            border-color: #2c7fb8;
        }
        
        .esquadrao-origem {
            margin-top: 10px;
            display: none;
        }
        
        .esquadrao-origem label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .esquadrao-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .esquadrao-badge.hipo {
            background-color: #e74c3c;
        }
        
        .esquadrao-badge.dh {
            background-color: #2ecc71;
        }
        
        .esquadrao-badge.outro {
            background-color: #f39c12;
        }
        
        /* MODAL DETALHES DO CAVALO */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            color: #2c7fb8;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .horse-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .detail-section {
            margin-bottom: 25px;
        }
        
        .detail-section h3 {
            color: #2c7fb8;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .detail-info p {
            margin-bottom: 10px;
            color: #555;
        }
        
        .detail-info p:last-child {
            margin-bottom: 0;
        }
        
        .prescription-section {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        
        .prescription-list {
            margin-bottom: 25px;
        }
        
        .prescription-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #2c7fb8;
            position: relative;
        }
        
        .prescription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .medication-name {
            font-weight: 600;
            color: #2c7fb8;
            font-size: 16px;
        }
        
        .medication-dosage {
            color: #666;
            font-size: 14px;
        }
        
        .prescription-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-delete:hover {
            background: #c0392b;
        }
        
        .medication-schedule {
            margin-top: 10px;
        }
        
        .schedule-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .day-box {
            width: 35px;
            height: 35px;
            border: 2px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
        }
        
        .day-box.applied {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }
        
        .day-box.not-applied {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .day-box:hover {
            transform: scale(1.1);
        }
        
        .day-label {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
        
        .day-status {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-prescription {
            margin-top: 20px;
            padding: 15px;
            background: #e6f7ff;
            border-radius: 8px;
            border: 2px dashed #2c7fb8;
        }
        
        .add-prescription-btn {
            background: #2c7fb8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .add-prescription-btn:hover {
            background: #1d5f8a;
        }
        
        .prescription-form {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }
        
        /* HISTÓRICO MÉDICO COM DATAS */
        .historico-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .historico-item:last-child {
            border-bottom: none;
        }
        
        .historico-data {
            font-weight: 600;
            color: #2c7fb8;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .historico-descricao {
            color: #666;
            font-size: 14px;
        }
        
        /* NOVOS ESTILOS PARA VISITAS */
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            color: #2c7fb8;
            border-bottom-color: #2c7fb8;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .visit-section {
            margin-bottom: 30px;
        }
        
        .visit-section h3 {
            color: #2c7fb8;
            margin-bottom: 15px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .visit-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .visit-table th {
            background: #2c7fb8;
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .visit-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .visit-table tr:last-child td {
            border-bottom: none;
        }
        
        .visit-table tr:hover {
            background: #f8f9fa;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .visit-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .protocolo-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background: #f39c12;
            color: white;
        }
        
        .suplementacao-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background: #2ecc71;
            color: white;
        }
        
        .quarentena-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background: #e74c3c;
            color: white;
        }
        
        .corte-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background: #9b59b6;
            color: white;
        }
        
        .visit-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        /* MODAL PARA ADICIONAR À VISITA */
        .visita-form-group {
            margin-bottom: 20px;
        }
        
        .visita-form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        /* MODAL DE CONFIRMAÇÃO DE EXCLUSÃO */
        .confirmation-modal {
            text-align: center;
        }
        
        .confirmation-icon {
            font-size: 48px;
            color: #e74c3c;
            margin-bottom: 20px;
        }
        
        .confirmation-message {
            margin-bottom: 25px;
            color: #555;
        }
        
        .confirmation-warning {
            background: #ffeaea;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .confirmation-warning h4 {
            color: #e74c3c;
            margin-bottom: 8px;
        }
        
        .confirmation-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-info {
                text-align: center;
            }
            
            .actions-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .horse-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .days-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .welcome-title {
                font-size: 2.5rem;
            }
            
            .welcome-subtitle {
                font-size: 1.4rem;
            }
            
            .welcome-user {
                font-size: 1.8rem;
            }
            
            .esquadrao-options {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                text-align: center;
            }
            
            .visit-table {
                display: block;
                overflow-x: auto;
            }
            
            .file-actions {
                flex-direction: column;
            }
            
            .btn-small {
                justify-content: center;
            }
            
            .confirmation-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div id="loginPage">
        <div class="login-container">
            <div class="logo">
                <div class="logo-image">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiByeD0iNjAiIGZpbGw9IiMyYzdmYjgiLz4KPHRleHQgeD0iNjAiIHk9IjY1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5WZXQ8L3RleHQ+Cjx0ZXh0IHg9IjYwIiB5PSI4NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TG9nbzwvdGV4dD4KPC9zdmc+" alt="Logo Veterinária">
                </div>
                <h1>Vet 2°rcg System</h1>
                <p>Sistema de Gestão Veterinária</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="role">Cargo</label>
                    <select id="role" required>
                        <option value="">Selecione seu cargo</option>
                        <option value="admin">Administrador (Ten)</option>
                        <option value="moderador">Moderador (Aux, Enf)</option>
                        <option value="visitante">Visitante (Estagiário)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário" required>
                    <select id="adminUsers" style="display: none; margin-top: 10px;">
                        <option value="">Selecione um administrador</option>
                        <option value="Maj. Cristovam">Maj. Cristovam</option>
                        <option value="Ten. Henrique">Ten. Henrique</option>
                        <option value="Ten. Thayanne">Ten. Thayanne</option>
                        <option value="Ten. Andressa">Ten. Andressa</option>
                        <option value="Ten. Aragon">Ten. Aragon</option>
                        <option value="Ten. Espinho">Ten. Espinho</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="password">Senha</label>
                    <div class="password-container">
                        <input type="password" id="password" placeholder="Digite a senha do seu cargo" required>
                        <button type="button" class="toggle-password" id="togglePassword">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="password-hint" id="passwordHint"></div>
                </div>
                
                <button type="submit" class="btn-login">Entrar no Sistema</button>
                
                <div class="error-message" id="errorMessage">
                    Senha incorreta para este cargo. Tente novamente.
                </div>
                
                <div class="success-message" id="successMessage">
                    Login realizado com sucesso! Redirecionando...
                </div>
            </form>
            
            <div class="permissions-info">
                <h3>Permissões do Sistema</h3>
                <ul>
                    <li><strong>Administrador (Ten):</strong> Acesso total ao sistema</li>
                    <li><strong>Moderador (Aux, Enf):</strong> Acesso a fichas e registros</li>
                    <li><strong>Visitante (Estagiário):</strong> Acesso limitado para consulta</li>
                </ul>
            </div>
            
            <div class="footer">
                &copy; 2025 Vet2°rcg System - Todos os direitos reservados
            </div>
        </div>
    </div>

    <!-- TELA DE TRANSIÇÃO -->
    <div id="welcomePage">
        <div class="welcome-container">
            <div class="welcome-logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiMyYzdmYjgiLz4KPHRleHQgeD0iNzUiIHk9IjgwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5WZXQ8L3RleHQ+Cjx0ZXh0IHg9Ijc1IiB5PSIxMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkxvZ288L3RleHQ+Cjwvc3ZnPg==" alt="Logo Veterinária">
            </div>
            <h1 class="welcome-title">Bem-vindo(a)</h1>
            <h2 class="welcome-subtitle">ao Vet2°rcg System</h2>
            <div class="welcome-user" id="welcomeUserName"></div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="welcome-message">Carregando seus arquivos...</p>
        </div>
    </div>

    <!-- TELA DE ARQUIVOS -->
    <div id="filesPage">
        <div class="header">
            <div class="logo-section">
                <div class="logo-image-small">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiByeD0iMzAiIGZpbGw9IiMyYzdmYjgiLz4KPHRleHQgeD0iMzAiIHk9IjM1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5WZXQ8L3RleHQ+Cjx0ZXh0IHg9IjMwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TG9nbzwvdGV4dD4KPC9zdmc+" alt="Logo Veterinária">
                </div>
                <div class="logo-text">
                    <h1>Vet 2°rcg System</h1>
                    <p>Sistema de Gestão Veterinária</p>
                </div>
            </div>
            <div class="user-info">
                <p>Logado como: <span id="loggedUser">Administrador</span></p>
                <button class="btn-logout" id="btnLogout">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Sair
                </button>
            </div>
        </div>
        
        <div class="main-container">
            <!-- Navegação por abas -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="arquivos">Arquivos de Cavalos</button>
                <button class="nav-tab" data-tab="visitas">Visitas Veterinárias</button>
            </div>
            
            <!-- Aba de Arquivos -->
            <div class="tab-content active" id="arquivosTab">
                <h1 class="page-title">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 13H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 9H9H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Arquivos de Cavalos
                </h1>
                
                <div class="actions-bar">
                    <div class="search-box">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Buscar cavalo...">
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="btnAddHorse">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Adicionar Cavalo
                        </button>
                        <button class="btn btn-secondary" id="btnExportAll">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Exportar Todos
                        </button>
                    </div>
                </div>
                
                <div class="alphabet-filter" id="alphabetFilter">
                    <!-- As letras serão geradas via JavaScript -->
                </div>
                
                <div class="files-grid" id="filesGrid">
                    <!-- Os arquivos serão gerados via JavaScript -->
                </div>
            </div>
            
            <!-- Aba de Visitas -->
            <div class="tab-content" id="visitasTab">
                <h1 class="page-title">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 21V5C19 3.89543 18.1046 3 17 3H7C5.89543 3 5 3.89543 5 5V21M19 21L21 21M19 21H14M5 21L3 21M5 21H10M9 6.99998H15M9 11H15M9 15H13" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Visitas Veterinárias
                </h1>
                
                <div class="visit-actions">
                    <button class="btn btn-visita" id="btnAbrirVisitas">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 21V5C19 3.89543 18.1046 3 17 3H7C5.89543 3 5 3.89543 5 5V21M19 21L21 21M19 21H14M5 21L3 21M5 21H10M9 6.99998H15M9 11H15M9 15H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Abrir Sistema de Visitas
                    </button>
                </div>
                
                <div class="visit-section">
                    <h3>HIPO</h3>
                    <table class="visit-table" id="hipoTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">Visita</th>
                                <th>Cavalo</th>
                                <th>Protocolo</th>
                                <th style="width: 100px;">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Conteúdo será preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="visit-section">
                    <h3>DH</h3>
                    <table class="visit-table" id="dhTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">Visita</th>
                                <th>Cavalo</th>
                                <th>Protocolo</th>
                                <th style="width: 100px;">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Conteúdo será preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Adicionar/Editar Cavalo -->
    <div class="modal" id="horseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Adicionar Novo Cavalo</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <form id="horseForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="horseName">Nome do Cavalo</label>
                        <input type="text" id="horseName" required>
                    </div>
                    <div class="form-group">
                        <label for="horseId">Identificação</label>
                        <input type="text" id="horseId" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horseColor">Cor</label>
                        <input type="text" id="horseColor" required>
                    </div>
                    <div class="form-group">
                        <label for="horseSex">Sexo</label>
                        <select id="horseSex" required>
                            <option value="">Selecione</option>
                            <option value="Macho">Macho</option>
                            <option value="Fêmea">Fêmea</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Esquadrão</label>
                    <div class="esquadrao-options">
                        <div class="esquadrao-option" data-value="Hipo">Hipo</div>
                        <div class="esquadrao-option" data-value="DH">D.H</div>
                        <div class="esquadrao-option" data-value="Outro">Outro</div>
                    </div>
                    <div class="esquadrao-origem" id="esquadraoOrigem">
                        <label for="horseOrigem">Digite a origem do animal</label>
                        <input type="text" id="horseOrigem">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="horseHistory">Histórico Médico</label>
                    <textarea id="horseHistory" rows="4"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="btnSave">Salvar Ficha</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Detalhes do Cavalo -->
    <div class="modal" id="horseDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="horseDetailTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Detalhes do Cavalo
                </h2>
                <button class="close-modal" id="closeDetailModal">&times;</button>
            </div>
            
            <div class="horse-detail-grid" id="horseDetailContent">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="btnCloseDetail">Fechar</button>
                <button type="button" class="btn btn-primary" id="btnEditHorse">Editar Ficha</button>
                <button type="button" class="btn btn-visita" id="btnAddToVisita">Adicionar à Visita</button>
                <button type="button" class="btn btn-danger" id="btnDeleteHorse">Excluir Ficha</button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar à Visita -->
    <div class="modal" id="visitaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar à Visita</h2>
                <button class="close-modal" id="closeVisitaModal">&times;</button>
            </div>
            
            <form id="visitaForm">
                <div class="visita-form-group">
                    <label for="visitaDescription">Descrição do que precisa ser feito</label>
                    <textarea id="visitaDescription" rows="4" placeholder="Descreva o que precisa ser feito com o cavalo..." required></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancelVisita">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="modal" id="deleteConfirmationModal">
        <div class="modal-content confirmation-modal">
            <div class="confirmation-icon">⚠️</div>
            <h2 class="modal-title">Confirmar Exclusão</h2>
            
            <div class="confirmation-message">
                <p>Tem certeza que deseja excluir a ficha do cavalo <strong id="deleteHorseName"></strong>?</p>
            </div>
            
            <div class="confirmation-warning">
                <h4>Atenção</h4>
                <p>Esta ficha será excluída permanentemente. Todos os dados do cavalo, incluindo histórico médico e prescrições, serão perdidos e não poderão ser recuperados.</p>
            </div>
            
            <div class="confirmation-actions">
                <button type="button" class="btn btn-secondary" id="btnCancelDelete">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmDelete">Sim, Excluir Permanentemente</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURAÇÕES DE LOGIN ==========
        // Senhas para cada tipo de permissão
        const passwords = {
            'admin': 'admin123',
            'moderador': 'mod456',
            'visitante': 'estag789'
        };
        
        // Dicas de senha para cada cargo
        const passwordHints = {
            'admin': 'Use a senha do Administrador',
            'moderador': 'Use a senha do Moderador',
            'visitante': 'Use a senha do Visitante'
        };
        
        // Lista de administradores
        const adminUsers = [
            'Maj. Cristovam',
            'Ten. Henrique', 
            'Ten. Thayanne',
            'Ten. Andressa',
            'Ten. Espinho'
        ];
        
        // ========== DADOS DOS CAVALOS ==========
        // Função para carregar dados do localStorage
        function loadHorsesFromStorage() {
            const storedHorses = localStorage.getItem('vetSystemHorses');
            if (storedHorses) {
                return JSON.parse(storedHorses);
            } else {
                // Dados padrão se não houver nada salvo
                return [
                    { 
                        id: 1, 
                        name: "Gastador", 
                        color: "Alazão", 
                        sex: "Macho", 
                        esquadrao: "Hipo",
                        origem: "",
                        history: [
                            { date: "15/11/2025", description: "Pós cirúrgico. Última consulta" },
                            { date: "10/11/2025", description: "Aplicação de vacina contra influenza" },
                            { date: "05/11/2025", description: "Exame de sangue realizado - resultados normais" }
                        ],
                        prescriptions: [
                            {
                                id: 1,
                                medication: "Anti-inflamatório",
                                dosage: "1 comprimido",
                                frequency: "2 vezes ao dia",
                                duration: 7,
                                startDate: "2025-01-15",
                                medicationDays: [
                                    { day: 1, status: "applied" },
                                    { day: 2, status: "applied" },
                                    { day: 3, status: "not-applied" },
                                    { day: 4, status: null },
                                    { day: 5, status: null },
                                    { day: 6, status: null },
                                    { day: 7, status: null }
                                ]
                            }
                        ],
                        protocolo: "Quarentena - PITE",
                        selectedForVisit: false,
                        visitaDescription: ""
                    },
                    { 
                        id: 2, 
                        name: "Afeição", 
                        color: "Tordilho", 
                        sex: "Fêmea", 
                        esquadrao: "DH",
                        origem: "",
                        history: [
                            { date: "20/11/2025", description: "Problema articular tratado. Controle semestral." },
                            { date: "15/10/2025", description: "Aplicação de suplemento articular" }
                        ],
                        prescriptions: [
                            {
                                id: 1,
                                medication: "Suplemento articular",
                                dosage: "2 comprimidos",
                                frequency: "1 vez ao dia",
                                duration: 30,
                                startDate: "2025-01-01",
                                medicationDays: Array.from({length: 30}, (_, i) => ({ 
                                    day: i + 1, 
                                    status: i < 14 ? "applied" : null 
                                }))
                            }
                        ],
                        protocolo: "Suplementação (Óleo)",
                        selectedForVisit: false,
                        visitaDescription: ""
                    },
                    { 
                        id: 3, 
                        name: "Gallen", 
                        color: "Preto", 
                        sex: "Fêmea", 
                        esquadrao: "Outro",
                        origem: "Haras Real",
                        history: [
                            { date: "18/11/2025", description: "Histórico de cólica. Dieta controlada." },
                            { date: "10/11/2025", description: "Exame de rotina - resultados satisfatórios" }
                        ],
                        prescriptions: [],
                        protocolo: "Quarentena",
                        selectedForVisit: false,
                        visitaDescription: ""
                    }
                ];
            }
        }
        
        // Função para salvar dados no localStorage
        function saveHorsesToStorage() {
            localStorage.setItem('vetSystemHorses', JSON.stringify(horses));
        }
        
        // Carregar dados iniciais
        let horses = loadHorsesFromStorage();
        
        // ========== ELEMENTOS DO DOM ==========
        // Login
        const loginPage = document.getElementById('loginPage');
        const welcomePage = document.getElementById('welcomePage');
        const filesPage = document.getElementById('filesPage');
        const roleSelect = document.getElementById('role');
        const usernameInput = document.getElementById('username');
        const adminUsersSelect = document.getElementById('adminUsers');
        const passwordInput = document.getElementById('password');
        const passwordHint = document.getElementById('passwordHint');
        const togglePassword = document.getElementById('togglePassword');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const loginForm = document.getElementById('loginForm');
        const welcomeUserName = document.getElementById('welcomeUserName');
        
        // Arquivos
        const alphabetFilter = document.getElementById('alphabetFilter');
        const filesGrid = document.getElementById('filesGrid');
        const searchInput = document.getElementById('searchInput');
        const btnAddHorse = document.getElementById('btnAddHorse');
        const btnExportAll = document.getElementById('btnExportAll');
        const horseModal = document.getElementById('horseModal');
        const closeModal = document.getElementById('closeModal');
        const btnCancel = document.getElementById('btnCancel');
        const horseForm = document.getElementById('horseForm');
        const modalTitle = document.getElementById('modalTitle');
        const btnLogout = document.getElementById('btnLogout');
        const loggedUser = document.getElementById('loggedUser');
        
        // Detalhes do cavalo
        const horseDetailModal = document.getElementById('horseDetailModal');
        const horseDetailTitle = document.getElementById('horseDetailTitle');
        const horseDetailContent = document.getElementById('horseDetailContent');
        const closeDetailModal = document.getElementById('closeDetailModal');
        const btnCloseDetail = document.getElementById('btnCloseDetail');
        const btnEditHorse = document.getElementById('btnEditHorse');
        const btnAddToVisita = document.getElementById('btnAddToVisita');
        const btnDeleteHorse = document.getElementById('btnDeleteHorse');
        
        // Visita
        const visitaModal = document.getElementById('visitaModal');
        const closeVisitaModal = document.getElementById('closeVisitaModal');
        const btnCancelVisita = document.getElementById('btnCancelVisita');
        const visitaForm = document.getElementById('visitaForm');
        
        // Exclusão
        const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
        const deleteHorseName = document.getElementById('deleteHorseName');
        const btnCancelDelete = document.getElementById('btnCancelDelete');
        const btnConfirmDelete = document.getElementById('btnConfirmDelete');
        
        // Visitas
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const btnAbrirVisitas = document.getElementById('btnAbrirVisitas');
        const hipoTable = document.getElementById('hipoTable').querySelector('tbody');
        const dhTable = document.getElementById('dhTable').querySelector('tbody');
        
        // Esquadrão
        const esquadraoOptions = document.querySelectorAll('.esquadrao-option');
        const esquadraoOrigem = document.getElementById('esquadraoOrigem');
        
        let currentHorseId = null;
        let currentFilter = 'all';
        let currentUser = '';
        let showPrescriptionForm = false;
        
        // ========== FUNÇÕES DE LOGIN ==========
        // Alternar entre input de texto e select para administradores
        roleSelect.addEventListener('change', function() {
            const selectedRole = this.value;
            
            // Limpar mensagens de erro/sucesso
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Atualizar dica de senha
            if (selectedRole && passwordHints[selectedRole]) {
                passwordHint.textContent = passwordHints[selectedRole];
            } else {
                passwordHint.textContent = '';
            }
            
            // Mostrar/ocultar select de administradores
            if (selectedRole === 'admin') {
                usernameInput.style.display = 'none';
                adminUsersSelect.style.display = 'block';
                adminUsersSelect.required = true;
                usernameInput.required = false;
            } else {
                usernameInput.style.display = 'block';
                adminUsersSelect.style.display = 'none';
                usernameInput.required = true;
                adminUsersSelect.required = false;
                usernameInput.value = '';
            }
            
            // Limpar seleção do select de administradores
            adminUsersSelect.value = '';
        });
        
        // Preencher automaticamente o campo de usuário quando selecionar um administrador
        adminUsersSelect.addEventListener('change', function() {
            if (this.value) {
                usernameInput.value = this.value;
            }
        });
        
        // Alternar visibilidade da senha
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Alterar ícone do olho
            if (type === 'text') {
                this.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.68192 3.96914 7.65663 6.06 6.06006M9.9 4.24006C10.5883 4.0789 11.2931 3.99836 12 4.00006C19 4.00006 23 12 23 12C22.393 13.1356 21.6691 14.2048 20.84 15.19M14.12 14.12C13.8454 14.4148 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.572 9.14351 13.1984C8.99262 12.8249 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2219 9.18488 10.8539C9.34884 10.4859 9.58525 10.1547 9.88 9.88006" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `;
            } else {
                this.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `;
            }
        });
        
        // Processar o formulário de login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const role = document.getElementById('role').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validar se todos os campos foram preenchidos
            if (!role) {
                errorMessage.textContent = 'Por favor, selecione um cargo.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            if (!username) {
                errorMessage.textContent = 'Por favor, preencha o usuário.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            if (!password) {
                errorMessage.textContent = 'Por favor, preencha a senha.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                return;
            }
            
            // Verificar se a senha está correta para o cargo selecionado
            if (password === passwords[role]) {
                // Login bem-sucedido
                errorMessage.style.display = 'none';
                successMessage.style.display = 'block';
                currentUser = username;
                
                // Salvar dados do usuário
                localStorage.setItem('vetSystemCurrentUser', JSON.stringify({
                    name: username,
                    role: role
                }));
                
                // Redirecionar para a tela de boas-vindas após 1 segundo
                setTimeout(function() {
                    showWelcomePage();
                }, 1000);
            } else {
                // Senha incorreta
                errorMessage.textContent = 'Senha incorreta para este cargo. Tente novamente.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
        });
        
        // ========== FUNÇÕES DE TRANSIÇÃO ==========
        // Mostrar tela de boas-vindas
        function showWelcomePage() {
            loginPage.style.display = 'none';
            welcomePage.style.display = 'flex';
            welcomeUserName.textContent = currentUser;
            
            // Redirecionar para a tela de arquivos após a animação (4.5 segundos)
            setTimeout(function() {
                showFilesPage();
            }, 4500);
        }
        
        // Mostrar tela de arquivos
        function showFilesPage() {
            welcomePage.style.display = 'none';
            filesPage.style.display = 'block';
            loggedUser.textContent = currentUser;
            generateAlphabetFilter();
            renderHorses();
            renderVisitas();
        }
        
        // Voltar para tela de login
        function showLoginPage() {
            filesPage.style.display = 'none';
            loginPage.style.display = 'flex';
            loginForm.reset();
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            passwordHint.textContent = '';
            usernameInput.style.display = 'block';
            adminUsersSelect.style.display = 'none';
        }
        
        // ========== FUNÇÕES DA TELA DE ARQUIVOS ==========
        // Gerar filtro alfabético
        function generateAlphabetFilter() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            alphabetFilter.innerHTML = '';
            
            // Botão "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'letter-btn active';
            allButton.textContent = 'TODOS';
            allButton.addEventListener('click', () => filterHorsesByLetter('all'));
            alphabetFilter.appendChild(allButton);
            
            // Botões para cada letra
            letters.forEach(letter => {
                const button = document.createElement('button');
                button.className = 'letter-btn';
                button.textContent = letter;
                button.addEventListener('click', () => filterHorsesByLetter(letter));
                alphabetFilter.appendChild(button);
            });
        }
        
        // Filtrar cavalos por letra
        function filterHorsesByLetter(letter) {
            currentFilter = letter;
            
            // Atualizar botões ativos
            document.querySelectorAll('.letter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.letter-btn').forEach(btn => {
                if (btn.textContent === letter || (letter === 'all' && btn.textContent === 'TODOS')) {
                    btn.classList.add('active');
                }
            });
            
            renderHorses();
        }
        
        // Renderizar lista de cavalos
        function renderHorses() {
            filesGrid.innerHTML = '';
            
            let filteredHorses = [...horses];
            
            // Aplicar filtro alfabético
            if (currentFilter !== 'all') {
                filteredHorses = filteredHorses.filter(horse => 
                    horse.name.toUpperCase().startsWith(currentFilter)
                );
            }
            
            // Aplicar filtro de busca
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredHorses = filteredHorses.filter(horse => 
                    horse.name.toLowerCase().includes(searchTerm) ||
                    horse.color.toLowerCase().includes(searchTerm) ||
                    horse.esquadrao.toLowerCase().includes(searchTerm)
                );
            }
            
            // Ordenar alfabeticamente
            filteredHorses.sort((a, b) => a.name.localeCompare(b.name));
            
            if (filteredHorses.length === 0) {
                filesGrid.innerHTML = `
                    <div class="no-results">
                        <h3>Nenhum cavalo encontrado</h3>
                        <p>Tente ajustar seus filtros de busca</p>
                    </div>
                `;
                return;
            }
            
            // Renderizar cada cavalo
            filteredHorses.forEach(horse => {
                const horseCard = document.createElement('div');
                horseCard.className = 'file-card';
                
                // Determinar a classe do badge baseado no esquadrão
                let badgeClass = '';
                if (horse.esquadrao === 'Hipo') badgeClass = 'hipo';
                else if (horse.esquadrao === 'DH') badgeClass = 'dh';
                else badgeClass = 'outro';
                
                horseCard.innerHTML = `
                    <h3 class="horse-name">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        ${horse.name}
                    </h3>
                    <div class="horse-details">
                        <div><strong>Cor:</strong> ${horse.color}</div>
                        <div><strong>Sexo:</strong> ${horse.sex}</div>
                        <div><strong>Esquadrão:</strong> 
                            <span class="esquadrao-badge ${badgeClass}">
                                ${horse.esquadrao}${horse.origem ? ` (${horse.origem})` : ''}
                            </span>
                        </div>
                        <div><strong>Protocolo:</strong> ${horse.protocolo || 'Nenhum'}</div>
                        ${horse.selectedForVisit ? '<div style="color: #9b59b6; font-weight: 600;">⭐ Adicionado à Visita</div>' : ''}
                    </div>
                    <div class="file-actions">
                        <button class="btn-small btn-edit" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Editar
                        </button>
                        <button class="btn-small btn-pdf" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            PDF
                        </button>
                        <button class="btn-small btn-visita-small" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 21V5C19 3.89543 18.1046 3 17 3H7C5.89543 3 5 3.89543 5 5V21M19 21L21 21M19 21H14M5 21L3 21M5 21H10M9 6.99998H15M9 11H15M9 15H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            ${horse.selectedForVisit ? 'Remover Visita' : 'Adicionar Visita'}
                        </button>
                        <button class="btn-small btn-delete-small" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Excluir
                        </button>
                    </div>
                `;
                filesGrid.appendChild(horseCard);
                
                // Adicionar evento de clique no card
                horseCard.addEventListener('click', (e) => {
                    // Evitar que o clique nos botões abra o modal
                    if (!e.target.closest('.file-actions')) {
                        openHorseDetail(horse.id);
                    }
                });
            });
            
            // Adicionar event listeners para os botões de edição
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    openEditModal(horseId);
                });
            });
            
            // Adicionar event listeners para os botões de PDF
            document.querySelectorAll('.btn-pdf').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    exportToPDF(horseId);
                });
            });
            
            // Adicionar event listeners para os botões de visita
            document.querySelectorAll('.btn-visita-small').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    const horse = horses.find(h => h.id === horseId);
                    if (horse) {
                        if (horse.selectedForVisit) {
                            // Remover da visita
                            horse.selectedForVisit = false;
                            horse.visitaDescription = "";
                            saveHorsesToStorage();
                            renderHorses();
                            renderVisitas();
                            alert(`${horse.name} removido da visita com sucesso!`);
                        } else {
                            // Adicionar à visita
                            openVisitaModal(horseId);
                        }
                    }
                });
            });
            
            // Adicionar event listeners para os botões de exclusão
            document.querySelectorAll('.btn-delete-small').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    openDeleteConfirmation(horseId);
                });
            });
        }
        
        // ========== FUNÇÕES DA ABA DE VISITAS ==========
        // Renderizar tabelas de visitas
        function renderVisitas() {
            // Limpar tabelas
            hipoTable.innerHTML = '';
            dhTable.innerHTML = '';
            
            // Separar cavalos por esquadrão
            const hipoHorses = horses.filter(horse => horse.esquadrao === 'Hipo' && horse.selectedForVisit);
            const dhHorses = horses.filter(horse => horse.esquadrao === 'DH' && horse.selectedForVisit);
            
            // Renderizar cavalos HIPO
            hipoHorses.forEach(horse => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-container">
                        <input type="checkbox" class="visit-checkbox" data-id="${horse.id}" ${horse.selectedForVisit ? 'checked' : ''}>
                    </td>
                    <td>${horse.name}</td>
                    <td>
                        ${getProtocoloBadge(horse.protocolo)}
                    </td>
                    <td>
                        <button class="btn-small btn-danger" data-id="${horse.id}">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Remover
                        </button>
                    </td>
                `;
                hipoTable.appendChild(row);
            });
            
            // Renderizar cavalos DH
            dhHorses.forEach(horse => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-container">
                        <input type="checkbox" class="visit-checkbox" data-id="${horse.id}" ${horse.selectedForVisit ? 'checked' : ''}>
                    </td>
                    <td>${horse.name}</td>
                    <td>
                        ${getProtocoloBadge(horse.protocolo)}
                    </td>
                    <td>
                        <button class="btn-small btn-danger" data-id="${horse.id}">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Remover
                        </button>
                    </td>
                `;
                dhTable.appendChild(row);
            });
            
            // Adicionar event listeners para os checkboxes
            document.querySelectorAll('.visit-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const horseId = parseInt(this.getAttribute('data-id'));
                    const horse = horses.find(h => h.id === horseId);
                    if (horse) {
                        horse.selectedForVisit = this.checked;
                        saveHorsesToStorage();
                        renderHorses();
                    }
                });
            });
            
            // Adicionar event listeners para os botões de remover
            document.querySelectorAll('.btn-danger').forEach(btn => {
                btn.addEventListener('click', function() {
                    const horseId = parseInt(this.getAttribute('data-id'));
                    const horse = horses.find(h => h.id === horseId);
                    if (horse) {
                        horse.selectedForVisit = false;
                        horse.visitaDescription = "";
                        saveHorsesToStorage();
                        renderHorses();
                        renderVisitas();
                        alert(`${horse.name} removido da visita com sucesso!`);
                    }
                });
            });
        }
        
        // Obter badge do protocolo
        function getProtocoloBadge(protocolo) {
            if (!protocolo) return '';
            
            if (protocolo.includes('Quarentena')) {
                return `<span class="quarentena-badge">${protocolo}</span>`;
            } else if (protocolo.includes('Suplementação') || protocolo.includes('Suplemento')) {
                return `<span class="suplementacao-badge">${protocolo}</span>`;
            } else if (protocolo.includes('Corte')) {
                return `<span class="corte-badge">${protocolo}</span>`;
            } else {
                return `<span class="protocolo-badge">${protocolo}</span>`;
            }
        }
        
        // Abrir sistema de visitas
        function abrirSistemaVisitas() {
            // Redireciona diretamente para a página de visitas
            window.location.href = 'visita.html';
        }
        
        // ========== FUNÇÕES DE NAVEGAÇÃO ==========
        // Alternar entre abas
        function switchTab(tabName) {
            // Atualizar botões de navegação
            navTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Atualizar conteúdo das abas
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}Tab`) {
                    content.classList.add('active');
                }
            });
        }
        
        // ========== FUNÇÕES RESTANTES ==========
        // Abrir modal de detalhes do cavalo
        function openHorseDetail(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            currentHorseId = horseId;
            horseDetailTitle.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Detalhes - ${horse.name}
            `;
            
            // Determinar a classe do badge baseado no esquadrão
            let badgeClass = '';
            if (horse.esquadrao === 'Hipo') badgeClass = 'hipo';
            else if (horse.esquadrao === 'DH') badgeClass = 'dh';
            else badgeClass = 'outro';
            
            // Construir conteúdo dos detalhes
            let detailContent = `
                <div class="detail-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Informações Básicas
                    </h3>
                    <div class="detail-info">
                        <p><strong>Nome:</strong> ${horse.name}</p>
                        <p><strong>Identificação:</strong> ${horse.id}</p>
                        <p><strong>Cor:</strong> ${horse.color}</p>
                        <p><strong>Sexo:</strong> ${horse.sex}</p>
                        <p><strong>Esquadrão:</strong> 
                            <span class="esquadrao-badge ${badgeClass}">
                                ${horse.esquadrao}${horse.origem ? ` (${horse.origem})` : ''}
                            </span>
                        </p>
                        <p><strong>Protocolo:</strong> ${horse.protocolo || 'Nenhum'}</p>
                        ${horse.selectedForVisit ? `<p><strong>Status Visita:</strong> <span style="color: #9b59b6; font-weight: 600;">Adicionado à Visita</span></p>` : ''}
                        ${horse.visitaDescription ? `<p><strong>Descrição da Visita:</strong> ${horse.visitaDescription}</p>` : ''}
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 2V8H20" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 13H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 17H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 9H9H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Histórico Médico
                    </h3>
                    <div class="detail-info">
            `;
            
            // Adicionar histórico médico com datas
            if (horse.history && horse.history.length > 0) {
                horse.history.forEach(item => {
                    detailContent += `
                        <div class="historico-item">
                            <div class="historico-data">${item.date}</div>
                            <div class="historico-descricao">${item.description}</div>
                        </div>
                    `;
                });
            } else {
                detailContent += `<p>Nenhum registro no histórico médico.</p>`;
            }
            
            detailContent += `
                    </div>
                </div>
            `;
            
            // Adicionar seção de prescrições médicas
            detailContent += `
                <div class="prescription-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4.5V19.5M19.5 12H4.5" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Prescrições Médicas
                    </h3>
                    
                    <div class="prescription-list">
            `;
            
            if (horse.prescriptions && horse.prescriptions.length > 0) {
                horse.prescriptions.forEach(prescription => {
                    detailContent += `
                        <div class="prescription-item">
                            <div class="prescription-header">
                                <div>
                                    <span class="medication-name">${prescription.medication}</span>
                                    <div class="medication-dosage">${prescription.dosage} - ${prescription.frequency}</div>
                                </div>
                                <div class="prescription-actions">
                                    <button class="btn-delete" data-prescription-id="${prescription.id}">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Excluir
                                    </button>
                                </div>
                            </div>
                            <div class="medication-schedule">
                                <div class="schedule-title">Controle de dosagem (${prescription.duration} dias):</div>
                                <div class="days-grid">
                    `;
                    
                    // Gerar quadrados para cada dia
                    prescription.medicationDays.forEach(dayInfo => {
                        const statusClass = dayInfo.status ? dayInfo.status : '';
                        const statusIcon = dayInfo.status === 'applied' ? '✓' : dayInfo.status === 'not-applied' ? '✗' : '';
                        
                        detailContent += `
                            <div>
                                <div class="day-box ${statusClass}" 
                                     data-prescription-id="${prescription.id}" 
                                     data-day="${dayInfo.day}">
                                    ${dayInfo.day}
                                    ${statusIcon ? `<div class="day-status">${statusIcon}</div>` : ''}
                                </div>
                                <div class="day-label">Dia ${dayInfo.day}</div>
                            </div>
                        `;
                    });
                    
                    detailContent += `
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                detailContent += `
                    <div class="detail-info">
                        <p>Nenhuma prescrição médica registrada.</p>
                    </div>
                `;
            }
            
            detailContent += `
                    </div>
                    
                    <div class="add-prescription">
                        <button class="add-prescription-btn" id="showPrescriptionForm">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Adicionar Nova Prescrição
                        </button>
            `;
            
            // Formulário de prescrição (inicialmente oculto)
            if (showPrescriptionForm) {
                detailContent += `
                    <div class="prescription-form" id="prescriptionForm">
                        <h4>Nova Prescrição</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="medicationName">Medicamento</label>
                                <input type="text" id="medicationName" required>
                            </div>
                            <div class="form-group">
                                <label for="medicationDosage">Dosagem</label>
                                <input type="text" id="medicationDosage" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="medicationFrequency">Frequência</label>
                                <input type="text" id="medicationFrequency" required>
                            </div>
                            <div class="form-group">
                                <label for="medicationDuration">Duração (dias)</label>
                                <input type="number" id="medicationDuration" min="1" max="90" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelPrescription">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="savePrescription">Salvar Prescrição</button>
                        </div>
                    </div>
                `;
            }
            
            detailContent += `
                    </div>
                </div>
            `;
            
            horseDetailContent.innerHTML = detailContent;
            
            // Adicionar event listeners para os quadrados de dias
            document.querySelectorAll('.day-box').forEach(box => {
                box.addEventListener('click', function() {
                    const prescriptionId = parseInt(this.getAttribute('data-prescription-id'));
                    const day = parseInt(this.getAttribute('data-day'));
                    toggleMedicationDay(horseId, prescriptionId, day, this);
                });
            });
            
            // Adicionar event listeners para os botões de exclusão
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const prescriptionId = parseInt(this.getAttribute('data-prescription-id'));
                    if (confirm('Tem certeza que deseja excluir esta prescrição?')) {
                        deletePrescription(horseId, prescriptionId);
                    }
                });
            });
            
            // Adicionar event listeners para o formulário de prescrição
            if (showPrescriptionForm) {
                document.getElementById('showPrescriptionForm').addEventListener('click', togglePrescriptionForm);
                document.getElementById('cancelPrescription').addEventListener('click', togglePrescriptionForm);
                document.getElementById('savePrescription').addEventListener('click', savePrescription);
            } else {
                document.getElementById('showPrescriptionForm').addEventListener('click', togglePrescriptionForm);
            }
            
            horseDetailModal.style.display = 'flex';
        }
        
        // Alternar status do dia da medicação
        function toggleMedicationDay(horseId, prescriptionId, day, element) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            const prescription = horse.prescriptions.find(p => p.id === prescriptionId);
            if (!prescription) return;
            
            const dayInfo = prescription.medicationDays.find(d => d.day === day);
            if (!dayInfo) return;
            
            // Ciclo de estados: null -> applied -> not-applied -> null
            if (dayInfo.status === null) {
                dayInfo.status = "applied";
                element.classList.add('applied');
                element.innerHTML = `${day}<div class="day-status">✓</div>`;
            } else if (dayInfo.status === "applied") {
                dayInfo.status = "not-applied";
                element.classList.remove('applied');
                element.classList.add('not-applied');
                element.innerHTML = `${day}<div class="day-status">✗</div>`;
            } else {
                dayInfo.status = null;
                element.classList.remove('not-applied');
                element.innerHTML = day;
            }
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
        }
        
        // Alternar visibilidade do formulário de prescrição
        function togglePrescriptionForm() {
            showPrescriptionForm = !showPrescriptionForm;
            openHorseDetail(currentHorseId);
        }
        
        // Salvar nova prescrição
        function savePrescription() {
            const medicationName = document.getElementById('medicationName').value;
            const medicationDosage = document.getElementById('medicationDosage').value;
            const medicationFrequency = document.getElementById('medicationFrequency').value;
            const medicationDuration = parseInt(document.getElementById('medicationDuration').value);
            
            if (!medicationName || !medicationDosage || !medicationFrequency || !medicationDuration) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            const horse = horses.find(h => h.id === currentHorseId);
            if (!horse) return;
            
            // Gerar ID único para a prescrição
            const newPrescriptionId = horse.prescriptions.length > 0 
                ? Math.max(...horse.prescriptions.map(p => p.id)) + 1 
                : 1;
            
            // Criar array de dias
            const medicationDays = Array.from({length: medicationDuration}, (_, i) => ({
                day: i + 1,
                status: null
            }));
            
            // Adicionar nova prescrição
            horse.prescriptions.push({
                id: newPrescriptionId,
                medication: medicationName,
                dosage: medicationDosage,
                frequency: medicationFrequency,
                duration: medicationDuration,
                startDate: new Date().toISOString().split('T')[0],
                medicationDays: medicationDays
            });
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
            
            // Fechar formulário e atualizar view
            showPrescriptionForm = false;
            openHorseDetail(currentHorseId);
            alert('Prescrição adicionada com sucesso!');
        }
        
        // Excluir prescrição
        function deletePrescription(horseId, prescriptionId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            const prescriptionIndex = horse.prescriptions.findIndex(p => p.id === prescriptionId);
            if (prescriptionIndex === -1) return;
            
            horse.prescriptions.splice(prescriptionIndex, 1);
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
            
            openHorseDetail(horseId);
            alert('Prescrição excluída com sucesso!');
        }
        
        // Abrir modal para adicionar/editar cavalo
        function openAddModal() {
            currentHorseId = null;
            modalTitle.textContent = 'Adicionar Novo Cavalo';
            horseForm.reset();
            esquadraoOrigem.style.display = 'none';
            
            // Limpar seleção de esquadrão
            esquadraoOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            horseModal.style.display = 'flex';
        }
        
        function openEditModal(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            currentHorseId = horseId;
            modalTitle.textContent = 'Editar Ficha do Cavalo';
            
            document.getElementById('horseName').value = horse.name;
            document.getElementById('horseId').value = horse.id;
            document.getElementById('horseColor').value = horse.color;
            document.getElementById('horseSex').value = horse.sex;
            
            // Definir esquadrão
            esquadraoOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-value') === horse.esquadrao) {
                    option.classList.add('selected');
                }
            });
            
            // Mostrar campo de origem se for "Outro"
            if (horse.esquadrao === 'Outro') {
                esquadraoOrigem.style.display = 'block';
                document.getElementById('horseOrigem').value = horse.origem;
            } else {
                esquadraoOrigem.style.display = 'none';
            }
            
            // Converter histórico para string
            const historyText = horse.history.map(item => `${item.date}: ${item.description}`).join('\n');
            document.getElementById('horseHistory').value = historyText;
            
            horseModal.style.display = 'flex';
        }
        
        // Abrir modal para adicionar à visita
        function openVisitaModal(horseId) {
            currentHorseId = horseId;
            document.getElementById('visitaDescription').value = '';
            visitaModal.style.display = 'flex';
        }
        
        // Abrir modal de confirmação de exclusão
        function openDeleteConfirmation(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            currentHorseId = horseId;
            deleteHorseName.textContent = horse.name;
            deleteConfirmationModal.style.display = 'flex';
        }
        
        // Excluir cavalo
        function deleteHorse() {
            const horseIndex = horses.findIndex(h => h.id === currentHorseId);
            if (horseIndex === -1) return;
            
            const horseName = horses[horseIndex].name;
            horses.splice(horseIndex, 1);
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
            
            // Fechar modais
            closeDeleteConfirmationModal();
            closeHorseDetailModal();
            
            // Atualizar interface
            renderHorses();
            renderVisitas();
            
            alert(`Ficha do cavalo "${horseName}" excluída permanentemente!`);
        }
        
        // Fechar modais
        function closeHorseModal() {
            horseModal.style.display = 'none';
        }
        
        function closeHorseDetailModal() {
            horseDetailModal.style.display = 'none';
            showPrescriptionForm = false;
        }
        
        function closeVisitaModal() {
            visitaModal.style.display = 'none';
        }
        
        function closeDeleteConfirmationModal() {
            deleteConfirmationModal.style.display = 'none';
        }
        
        // Salvar cavalo (adicionar ou editar)
        function saveHorse(e) {
            e.preventDefault();
            
            const horseName = document.getElementById('horseName').value;
            const horseId = currentHorseId ? currentHorseId : Math.max(0, ...horses.map(h => h.id)) + 1;
            const horseColor = document.getElementById('horseColor').value;
            const horseSex = document.getElementById('horseSex').value;
            const horseHistory = document.getElementById('horseHistory').value;
            
            // Obter esquadrão selecionado
            let selectedEsquadrao = '';
            let origem = '';
            
            esquadraoOptions.forEach(option => {
                if (option.classList.contains('selected')) {
                    selectedEsquadrao = option.getAttribute('data-value');
                }
            });
            
            if (selectedEsquadrao === 'Outro') {
                origem = document.getElementById('horseOrigem').value;
                if (!origem) {
                    alert('Por favor, digite a origem do animal.');
                    return;
                }
            }
            
            if (!selectedEsquadrao) {
                alert('Por favor, selecione um esquadrão.');
                return;
            }
            
            // Converter histórico de volta para array
            const historyArray = [];
            if (horseHistory) {
                const lines = horseHistory.split('\n');
                lines.forEach(line => {
                    if (line.trim()) {
                        // Tentar extrair data do início da linha
                        const dateMatch = line.match(/^(\d{2}\/\d{2}\/\d{4}):\s*(.*)/);
                        if (dateMatch) {
                            historyArray.push({
                                date: dateMatch[1],
                                description: dateMatch[2]
                            });
                        } else {
                            // Se não encontrar formato de data, usar data atual
                            const today = new Date();
                            const formattedDate = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth()+1).toString().padStart(2, '0')}/${today.getFullYear()}`;
                            historyArray.push({
                                date: formattedDate,
                                description: line.trim()
                            });
                        }
                    }
                });
            }
            
            const horseData = {
                name: horseName,
                id: horseId,
                color: horseColor,
                sex: horseSex,
                esquadrao: selectedEsquadrao,
                origem: origem,
                history: historyArray,
                prescriptions: currentHorseId ? horses.find(h => h.id === currentHorseId).prescriptions : [],
                protocolo: currentHorseId ? horses.find(h => h.id === currentHorseId).protocolo : "Quarentena",
                selectedForVisit: currentHorseId ? horses.find(h => h.id === currentHorseId).selectedForVisit : false,
                visitaDescription: currentHorseId ? horses.find(h => h.id === currentHorseId).visitaDescription : ""
            };
            
            if (currentHorseId) {
                // Editar cavalo existente
                const index = horses.findIndex(h => h.id === currentHorseId);
                if (index !== -1) {
                    horses[index] = horseData;
                }
            } else {
                // Adicionar novo cavalo
                horses.push(horseData);
            }
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
            
            closeHorseModal();
            renderHorses();
            renderVisitas();
            alert('Ficha salva com sucesso!');
        }
        
        // Salvar visita
        function saveVisita(e) {
            e.preventDefault();
            
            const description = document.getElementById('visitaDescription').value;
            
            if (!description) {
                alert('Por favor, preencha a descrição da visita.');
                return;
            }
            
            const horse = horses.find(h => h.id === currentHorseId);
            if (!horse) return;
            
            // Adicionar à visita
            horse.selectedForVisit = true;
            horse.visitaDescription = description;
            
            // Salvar alterações no localStorage
            saveHorsesToStorage();
            
            closeVisitaModal();
            renderHorses();
            renderVisitas();
            alert(`${horse.name} adicionado à visita com sucesso!\n\nDescrição: ${description}`);
        }
        
        // Exportar para PDF
        function exportToPDF(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            alert(`Gerando PDF para ${horse.name}...\n\nEm um sistema real, isso geraria um arquivo PDF com todas as informações da ficha.`);
        }
        
        // Exportar todos para PDF
        function exportAllToPDF() {
            alert('Exportando todas as fichas para PDF...\n\nEm um sistema real, isso geraria um arquivo ZIP com PDFs de todos os cavalos.');
        }
        
        // Fazer logout
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                showLoginPage();
            }
        }
        
        // ========== INICIALIZAÇÃO ==========
        function init() {
            // Event Listeners da tela de arquivos
            btnAddHorse.addEventListener('click', openAddModal);
            btnExportAll.addEventListener('click', exportAllToPDF);
            closeModal.addEventListener('click', closeHorseModal);
            btnCancel.addEventListener('click', closeHorseModal);
            horseForm.addEventListener('submit', saveHorse);
            searchInput.addEventListener('input', renderHorses);
            btnLogout.addEventListener('click', logout);
            
            // Event Listeners do modal de detalhes
            closeDetailModal.addEventListener('click', closeHorseDetailModal);
            btnCloseDetail.addEventListener('click', closeHorseDetailModal);
            btnEditHorse.addEventListener('click', () => {
                closeHorseDetailModal();
                openEditModal(currentHorseId);
            });
            btnAddToVisita.addEventListener('click', () => {
                closeHorseDetailModal();
                openVisitaModal(currentHorseId);
            });
            btnDeleteHorse.addEventListener('click', () => {
                closeHorseDetailModal();
                openDeleteConfirmation(currentHorseId);
            });
            
            // Event Listeners do modal de visita
            closeVisitaModal.addEventListener('click', closeVisitaModal);
            btnCancelVisita.addEventListener('click', closeVisitaModal);
            visitaForm.addEventListener('submit', saveVisita);
            
            // Event Listeners do modal de exclusão
            btnCancelDelete.addEventListener('click', closeDeleteConfirmationModal);
            btnConfirmDelete.addEventListener('click', deleteHorse);
            
            // Event Listeners para opções de esquadrão
            esquadraoOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remover seleção de todas as opções
                    esquadraoOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Selecionar a opção clicada
                    this.classList.add('selected');
                    
                    // Mostrar/ocultar campo de origem
                    if (this.getAttribute('data-value') === 'Outro') {
                        esquadraoOrigem.style.display = 'block';
                    } else {
                        esquadraoOrigem.style.display = 'none';
                    }
                });
            });
            
            // Event Listeners para navegação entre abas
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Event Listeners para visitas
            btnAbrirVisitas.addEventListener('click', abrirSistemaVisitas);
            
            // Fechar modais ao clicar fora deles
            window.addEventListener('click', (e) => {
                if (e.target === horseModal) {
                    closeHorseModal();
                }
                if (e.target === horseDetailModal) {
                    closeHorseDetailModal();
                }
                if (e.target === visitaModal) {
                    closeVisitaModal();
                }
                if (e.target === deleteConfirmationModal) {
                    closeDeleteConfirmationModal();
                }
            });
            
            // Limpar mensagens quando o usuário começar a digitar (login)
            document.getElementById('username').addEventListener('input', function() {
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
            });
            
            document.getElementById('password').addEventListener('input', function() {
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
            });
        }
        
        // Iniciar a aplicação
        init();
    </script>
</body>
</html>
