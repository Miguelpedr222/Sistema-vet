<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitas Veterinárias - Vet 2°rcg System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ESTILOS DA TELA DE VISITAS */
        #filesPage {
            display: block;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.8s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2c7fb8;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-image-small {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #2c7fb8;
            overflow: hidden;
        }
        
        .logo-image-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text h1 {
            color: #2c7fb8;
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: #666;
            font-size: 14px;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-info span {
            color: #2c7fb8;
            font-weight: 600;
        }
        
        .btn-logout {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-logout:hover {
            background: #c0392b;
        }
        
        .main-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-title {
            color: #2c7fb8;
            margin-bottom: 25px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-title svg {
            width: 30px;
            height: 30px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2c7fb8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d5f8a;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #7fcdbb;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5bbfa5;
            transform: translateY(-2px);
        }
        
        .btn-voltar {
            background: #f39c12;
            color: white;
            margin-bottom: 20px;
        }
        
        .btn-voltar:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }
        
        /* NOVOS ESTILOS PARA CADERNO DE VISITAS */
        .caderno-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .caderno-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .caderno-date {
            font-weight: 600;
            color: #2c7fb8;
            font-size: 18px;
        }
        
        .caderno-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .caderno-status.active {
            background: #27ae60;
        }
        
        .caderno-status.inactive {
            background: #7f8c8d;
        }
        
        .caderno-actions {
            display: flex;
            gap: 10px;
        }
        
        .caderno-list {
            margin-bottom: 30px;
        }
        
        .caderno-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            background: white;
            transition: all 0.3s;
        }
        
        .caderno-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .caderno-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .caderno-horse-name {
            font-weight: 600;
            color: #2c7fb8;
            font-size: 16px;
        }
        
        .caderno-horse-esquadrao {
            font-size: 12px;
            color: #666;
        }
        
        .caderno-visit-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .caderno-visit-desc {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            color: #555;
        }
        
        .esquadrao-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .esquadrao-badge.hipo {
            background-color: #e74c3c;
        }
        
        .esquadrao-badge.dh {
            background-color: #2ecc71;
        }
        
        .esquadrao-badge.outro {
            background-color: #f39c12;
        }
        
        .archived-visitas {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .archived-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .archived-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .archived-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .archived-date {
            font-weight: 600;
            color: #2c7fb8;
            margin-bottom: 10px;
        }
        
        .archived-count {
            font-size: 14px;
            color: #666;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        /* MODAL PARA CRIAR NOVO CADERNO */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            color: #2c7fb8;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2c7fb8;
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 127, 184, 0.2);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-info {
                text-align: center;
            }
            
            .caderno-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .caderno-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .caderno-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .caderno-visit-status {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- TELA DE VISITAS -->
    <div id="filesPage">
        <div class="header">
            <div class="logo-section">
                <div class="logo-image-small">
                    <img src="2-rcg-926x926 (1).jpg" alt="Logo Veterinária">
                </div>
                <div class="logo-text">
                    <h1>Vet 2°rcg System</h1>
                    <p>Gestão de Visitas Veterinárias</p>
                    <p>Atualização diaria pela Enfermeiro Veterinário de dia.</p>
                </div>
            </div>
            <div class="user-info">
                <p>Logado como: <span id="loggedUser">Administrador</span></p>
                <button class="btn btn-voltar" id="btnVoltar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Voltar para Arquivos
                </button>
            </div>
        </div>
        
        <div class="main-container">
            <h1 class="page-title">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 21V5C19 3.89543 18.1046 3 17 3H7C5.89543 3 5 3.89543 5 5V21M19 21L21 21M19 21H14M5 21L3 21M5 21H10M9 6.99998H15M9 11H15M9 15H13" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Visitas Veterinárias
            </h1>
            
            <div class="caderno-header">
                <div class="caderno-info">
                    <div class="caderno-date" id="currentCadernoDate">Nenhum caderno ativo</div>
                    <div class="caderno-status inactive" id="cadernoStatus">Inativo</div>
                </div>
                <div class="caderno-actions">
                    <button class="btn btn-primary" id="btnNovoCaderno">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Novo Caderno
                    </button>
                    <button class="btn btn-secondary" id="btnArquivarCaderno" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 16V8.00002C20.9996 7.6493 20.9071 7.30483 20.7315 7.00119C20.556 6.69754 20.3037 6.44539 20 6.27002L13 2.27002C12.696 2.09449 12.3511 2.00208 12 2.00208C11.6489 2.00208 11.304 2.09449 11 2.27002L4 6.27002C3.69626 6.44539 3.44398 6.69754 3.26846 7.00119C3.09294 7.30483 3.00036 7.6493 3 8.00002V16C3.00036 16.3508 3.09294 16.6952 3.26846 16.9989C3.44398 17.3025 3.69626 17.5547 4 17.73L11 21.73C11.304 21.9056 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9056 13 21.73L20 17.73C20.3037 17.5547 20.556 17.3025 20.7315 16.9989C20.9071 16.6952 20.9996 16.3508 21 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3.27002 6.95996L12 12L20.73 6.95996" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 22.08V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Arquivar
                    </button>
                </div>
            </div>
            
            <div class="caderno-list" id="cadernoList">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            
            <div class="archived-visitas" id="archivedVisitas" style="display: none;">
                <h3 style="color: #2c7fb8; margin-bottom: 15px; font-size: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0;">
                    Visitas Arquivadas
                </h3>
                <div class="archived-list" id="archivedList">
                    <!-- Conteúdo será preenchido via JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Criar Novo Caderno -->
    <div class="modal" id="cadernoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Criar Novo Caderno de Visitas</h2>
                <button class="close-modal" id="closeCadernoModal">&times;</button>
            </div>
            
            <form id="cadernoForm">
                <div class="form-group">
                    <label for="cadernoDate">Data da Visita</label>
                    <input type="date" id="cadernoDate" required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancelCaderno">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Caderno</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========== DADOS DAS VISITAS ==========
        // Função para carregar dados das visitas do localStorage
        function loadVisitasFromStorage() {
            const storedVisitas = localStorage.getItem('vetSystemVisitas');
            if (storedVisitas) {
                return JSON.parse(storedVisitas);
            } else {
                return {
                    cadernosAtivos: [],
                    cadernosArquivados: []
                };
            }
        }

        // Função para salvar dados das visitas no localStorage
        function saveVisitasToStorage() {
            localStorage.setItem('vetSystemVisitas', JSON.stringify(visitas));
        }

        // Carregar dados iniciais das visitas
        let visitas = loadVisitasFromStorage();
        let currentCaderno = null;

        // ========== ELEMENTOS DO DOM ==========
        const loggedUser = document.getElementById('loggedUser');
        const btnVoltar = document.getElementById('btnVoltar');
        const currentCadernoDate = document.getElementById('currentCadernoDate');
        const cadernoStatus = document.getElementById('cadernoStatus');
        const btnNovoCaderno = document.getElementById('btnNovoCaderno');
        const btnArquivarCaderno = document.getElementById('btnArquivarCaderno');
        const cadernoList = document.getElementById('cadernoList');
        const archivedList = document.getElementById('archivedList');
        const archivedVisitas = document.getElementById('archivedVisitas');
        
        // Modal
        const cadernoModal = document.getElementById('cadernoModal');
        const closeCadernoModal = document.getElementById('closeCadernoModal');
        const btnCancelCaderno = document.getElementById('btnCancelCaderno');
        const cadernoForm = document.getElementById('cadernoForm');

        // ========== FUNÇÕES PRINCIPAIS ==========
        // Inicializar a página
        function init() {
            // Carregar dados do usuário
            const userData = localStorage.getItem('vetSystemCurrentUser');
            if (userData) {
                const user = JSON.parse(userData);
                loggedUser.textContent = user.name;
            }

            renderVisitas();
            setupEventListeners();
        }

        // Configurar event listeners
        function setupEventListeners() {
            btnVoltar.addEventListener('click', voltarParaArquivos);
            btnNovoCaderno.addEventListener('click', openCadernoModal);
            btnArquivarCaderno.addEventListener('click', archiveCurrentCaderno);
            
            // Modal
            closeCadernoModal.addEventListener('click', closeCadernoModalFunc);
            btnCancelCaderno.addEventListener('click', closeCadernoModalFunc);
            cadernoForm.addEventListener('submit', saveCaderno);
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', (e) => {
                if (e.target === cadernoModal) {
                    closeCadernoModalFunc();
                }
            });
        }

        // Voltar para a página de arquivos
        function voltarParaArquivos() {
            window.location.href = 'index.html';
        }

        // Renderizar visitas
        function renderVisitas() {
            // Verificar se há caderno ativo
            currentCaderno = visitas.cadernosAtivos.length > 0 ? visitas.cadernosAtivos[0] : null;
            
            if (currentCaderno) {
                currentCadernoDate.textContent = `Caderno de Visitas - ${formatDate(currentCaderno.data)}`;
                cadernoStatus.textContent = 'Ativo';
                cadernoStatus.className = 'caderno-status active';
                btnArquivarCaderno.disabled = false;
            } else {
                currentCadernoDate.textContent = 'Nenhum caderno ativo';
                cadernoStatus.textContent = 'Inativo';
                cadernoStatus.className = 'caderno-status inactive';
                btnArquivarCaderno.disabled = true;
            }
            
            // Renderizar lista de visitas do caderno ativo
            renderCadernoList();
            
            // Renderizar visitas arquivadas
            renderArchivedList();
        }

        // Renderizar lista do caderno ativo
        function renderCadernoList() {
            cadernoList.innerHTML = '';
            
            if (!currentCaderno) {
                cadernoList.innerHTML = `
                    <div class="no-results">
                        <h3>Nenhum caderno de visitas ativo</h3>
                        <p>Crie um novo caderno para começar a registrar visitas</p>
                    </div>
                `;
                return;
            }
            
            if (currentCaderno.visitas.length === 0) {
                cadernoList.innerHTML = `
                    <div class="no-results">
                        <h3>Nenhuma visita registrada para este caderno</h3>
                        <p>Adicione cavalos à visita através da aba de Arquivos</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por esquadrão (Hipo primeiro)
            const visitasOrdenadas = [...currentCaderno.visitas].sort((a, b) => {
                if (a.esquadrao === 'Hipo' && b.esquadrao !== 'Hipo') return -1;
                if (a.esquadrao !== 'Hipo' && b.esquadrao === 'Hipo') return 1;
                return a.name.localeCompare(b.name);
            });
            
            // Renderizar cada visita
            visitasOrdenadas.forEach(visita => {
                const visitaItem = document.createElement('div');
                visitaItem.className = 'caderno-item';
                
                visitaItem.innerHTML = `
                    <div class="caderno-item-header">
                        <div>
                            <div class="caderno-horse-name">${visita.name}</div>
                            <div class="caderno-horse-esquadrao">
                                <span class="esquadrao-badge ${visita.esquadrao.toLowerCase()}">${visita.esquadrao}</span>
                            </div>
                        </div>
                        <div class="caderno-visit-status">
                            <label>
                                <input type="checkbox" class="visit-status-checkbox" data-id="${visita.horseId}" ${visita.visited ? 'checked' : ''}>
                                Visitado
                            </label>
                        </div>
                    </div>
                    <div class="caderno-visit-desc">
                        <strong>Descrição:</strong> ${visita.description}
                    </div>
                `;
                
                cadernoList.appendChild(visitaItem);
            });
            
            // Adicionar event listeners para os checkboxes de status
            document.querySelectorAll('.visit-status-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const horseId = parseInt(this.getAttribute('data-id'));
                    updateVisitStatus(horseId, this.checked);
                });
            });
        }

        // Renderizar lista de visitas arquivadas
        function renderArchivedList() {
            archivedList.innerHTML = '';
            
            if (visitas.cadernosArquivados.length === 0) {
                archivedVisitas.style.display = 'none';
                return;
            }
            
            archivedVisitas.style.display = 'block';
            
            // Ordenar por data (mais recente primeiro)
            const cadernosOrdenados = [...visitas.cadernosArquivados].sort((a, b) => 
                new Date(b.data) - new Date(a.data)
            );
            
            // Renderizar cada caderno arquivado
            cadernosOrdenados.forEach(caderno => {
                const archivedItem = document.createElement('div');
                archivedItem.className = 'archived-item';
                
                const visitasCount = caderno.visitas.length;
                const visitasRealizadas = caderno.visitas.filter(v => v.visited).length;
                
                archivedItem.innerHTML = `
                    <div class="archived-date">${formatDate(caderno.data)}</div>
                    <div class="archived-count">
                        ${visitasRealizadas}/${visitasCount} visitas realizadas
                    </div>
                `;
                
                archivedList.appendChild(archivedItem);
            });
        }

        // Atualizar status da visita
        function updateVisitStatus(horseId, visited) {
            if (!currentCaderno) return;
            
            const visita = currentCaderno.visitas.find(v => v.horseId === horseId);
            if (visita) {
                visita.visited = visited;
                saveVisitasToStorage();
            }
        }

        // Abrir modal para criar caderno
        function openCadernoModal() {
            // Definir data padrão como hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('cadernoDate').value = today;
            cadernoModal.style.display = 'flex';
        }

        // Fechar modal do caderno
        function closeCadernoModalFunc() {
            cadernoModal.style.display = 'none';
        }

        // Criar novo caderno
        function createCaderno(data) {
            // Verificar se já existe um caderno ativo
            if (visitas.cadernosAtivos.length > 0) {
                if (!confirm('Já existe um caderno ativo. Deseja arquivá-lo e criar um novo?')) {
                    return;
                }
                
                // Arquivar caderno atual
                archiveCurrentCaderno();
            }
            
            const novoCaderno = {
                id: Date.now(),
                data: data,
                visitas: []
            };
            
            visitas.cadernosAtivos.push(novoCaderno);
            saveVisitasToStorage();
            currentCaderno = novoCaderno;
            renderVisitas();
            
            alert('Caderno criado com sucesso!');
        }

        // Arquivar caderno atual
        function archiveCurrentCaderno() {
            if (!currentCaderno) return;
            
            // Mover caderno ativo para arquivados
            const index = visitas.cadernosAtivos.findIndex(c => c.id === currentCaderno.id);
            if (index !== -1) {
                visitas.cadernosAtivos.splice(index, 1);
                visitas.cadernosArquivados.push(currentCaderno);
                saveVisitasToStorage();
                currentCaderno = null;
                renderVisitas();
                
                alert('Caderno arquivado com sucesso!');
            }
        }

        // Salvar caderno
        function saveCaderno(e) {
            e.preventDefault();
            
            const date = document.getElementById('cadernoDate').value;
            
            if (!date) {
                alert('Por favor, selecione uma data.');
                return;
            }
            
            createCaderno(date);
            closeCadernoModalFunc();
        }

        // ========== FUNÇÕES AUXILIARES ==========
        // Formatar data para exibição
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // ========== INICIALIZAÇÃO ==========
        // Iniciar a aplicação quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
