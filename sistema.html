<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Veterinário</title>
    <!-- Incluindo Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ESTILOS DA TELA DE TRANSIÇÃO */
        #welcomePage {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c7fb8 0%, #7fcdbb 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        .welcome-container {
            max-width: 600px;
            padding: 40px;
            animation: fadeInUp 1s ease-out;
        }
        
        .welcome-logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .welcome-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .welcome-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease 0.5s forwards;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .welcome-subtitle {
            font-size: 1.8rem;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 0.8s ease 1s forwards;
            font-weight: 300;
        }
        
        .welcome-user {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 0.8s ease 1.5s forwards;
            color: #ffeb3b;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .loading-bar {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 30px auto;
            opacity: 0;
            animation: fadeIn 0.8s ease 2s forwards;
        }
        
        .loading-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            border-radius: 10px;
            animation: loading 2.5s ease 2.2s forwards;
        }
        
        .welcome-message {
            font-size: 1.2rem;
            opacity: 0;
            animation: fadeIn 0.8s ease 2.5s forwards;
            margin-top: 20px;
            font-weight: 300;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes loading {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }
        
        /* ESTILOS DA TELA DE ARQUIVOS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        #filesPage {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.8s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2c7fb8;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-image-small {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #2c7fb8;
            overflow: hidden;
        }
        
        .logo-image-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text h1 {
            color: #2c7fb8;
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: #666;
            font-size: 14px;
        }
        
        .user-info {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info span {
            color: #2c7fb8;
            font-weight: 600;
        }
        
        .btn-logout {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-logout:hover {
            background: #c0392b;
        }
        
        /* NOVO ESTILO PARA O BOTÃO VISITA */
        .btn-visita-redirect {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-visita-redirect:hover {
            background: #8e44ad;
        }
        
        .main-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-title {
            color: #2c7fb8;
            margin-bottom: 25px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-title svg {
            width: 30px;
            height: 30px;
        }
        
        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px 15px;
            width: 300px;
        }
        
        .search-box input {
            border: none;
            background: transparent;
            padding: 8px;
            width: 100%;
            outline: none;
        }
        
        .search-box svg {
            color: #666;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2c7fb8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d5f8a;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #7fcdbb;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5bbfa5;
            transform: translateY(-2px);
        }
        
        .alphabet-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .letter-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: white;
            color: #2c7fb8;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .letter-btn:hover, .letter-btn.active {
            background: #2c7fb8;
            color: white;
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .file-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #2c7fb8;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .horse-name {
            color: #2c7fb8;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .horse-details {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .horse-details div {
            margin-bottom: 5px;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        
        .btn-edit:hover {
            background: #e67e22;
        }
        
        .btn-pdf {
            background: #e74c3c;
            color: white;
        }
        
        .btn-pdf:hover {
            background: #c0392b;
        }

        /* NOVO BOTÃO EXCLUIR */
        .btn-delete-horse {
            background: #e74c3c;
            color: white;
        }
        
        .btn-delete-horse:hover {
            background: #c0392b;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        /* NOVOS ESTILOS PARA ESQUADRÃO */
        .esquadrao-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .esquadrao-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .esquadrao-option:hover {
            border-color: #2c7fb8;
        }
        
        .esquadrao-option.selected {
            background-color: #2c7fb8;
            color: white;
            border-color: #2c7fb8;
        }
        
        .esquadrao-origem {
            margin-top: 10px;
            display: none;
        }
        
        .esquadrao-origem label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .esquadrao-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .esquadrao-badge.hipo {
            background-color: #e74c3c;
        }
        
        .esquadrao-badge.dh {
            background-color: #2ecc71;
        }
        
        .esquadrao-badge.outro {
            background-color: #f39c12;
        }
        
        /* MODAL DETALHES DO CAVALO */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            color: #2c7fb8;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .horse-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .detail-section {
            margin-bottom: 25px;
        }
        
        .detail-section h3 {
            color: #2c7fb8;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .detail-info p {
            margin-bottom: 10px;
            color: #555;
        }
        
        .detail-info p:last-child {
            margin-bottom: 0;
        }
        
        /* BOTÃO DA SERINGA PARA PRESCRIÇÕES */
        .prescription-icon-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #2c7fb8;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .prescription-icon-btn:hover {
            background: #1d5f8a;
            transform: scale(1.1);
        }
        
        .prescription-icon-btn svg {
            width: 24px;
            height: 24px;
        }
        
        /* NOVO ESTILO PARA TIMELINE DE HISTÓRICO MÉDICO */
        .timeline-section {
            margin-top: 20px;
        }
        
        .timeline-container {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #2c7fb8;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2c7fb8;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .timeline-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2c7fb8;
            border: 2px solid white;
            z-index: 1;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .timeline-date {
            font-weight: 600;
            color: #2c7fb8;
            font-size: 16px;
        }
        
        .timeline-expand {
            background: #2c7fb8;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }
        
        .timeline-expand:hover {
            background: #1d5f8a;
            transform: scale(1.1);
        }
        
        /* JANELAS FLUTUANTES */
        .floating-window {
            display: none;
            position: fixed;
            z-index: 2000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid #e0e0e0;
            min-width: 300px;
            max-width: 500px;
            animation: fadeIn 0.3s ease;
            resize: both;
            overflow: auto;
        }
        
        .floating-window.active {
            display: block;
        }
        
        .window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #2c7fb8;
            color: white;
            border-radius: 8px 8px 0 0;
            cursor: move;
        }
        
        .window-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .window-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .window-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .window-content {
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .window-content p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .window-content p:last-child {
            margin-bottom: 0;
        }
        
        /* CONTROLE DE DOSAGEM */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .day-box {
            width: 35px;
            height: 35px;
            border: 2px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
        }
        
        .day-box.applied {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }
        
        .day-box.not-applied {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .day-box:hover {
            transform: scale(1.1);
        }
        
        .day-label {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
        
        .day-status {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* FORMULÁRIO DE EDIÇÃO DO HISTÓRICO */
        .history-edit-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #ddd;
        }
        
        .history-edit-form h4 {
            color: #2c7fb8;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2c7fb8;
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 127, 184, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }
        
        /* BOTÃO PARA ADICIONAR NOVO HISTÓRICO */
        .add-history-btn {
            background: #2c7fb8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            margin-top: 15px;
        }
        
        .add-history-btn:hover {
            background: #1d5f8a;
        }
        
        /* NOVOS ESTILOS PARA HISTÓRICO DE CÓLICAS */
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            color: #2c7fb8;
            border-bottom-color: #2c7fb8;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ESTILOS PARA CONTROLE DE CÓLICAS */
        .colica-control-section {
            margin-bottom: 30px;
        }
        
        .colica-control-section h3 {
            color: #2c7fb8;
            margin-bottom: 15px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .colica-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #2c7fb8;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .stat-card.severity-high {
            border-top: 4px solid #e74c3c;
        }
        
        .stat-card.severity-medium {
            border-top: 4px solid #f39c12;
        }
        
        .stat-card.severity-low {
            border-top: 4px solid #2ecc71;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .chart-title {
            color: #2c7fb8;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .colica-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .btn-colica {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-colica:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        .btn-colica.new {
            background: #e74c3c;
        }
        
        .btn-colica.new:hover {
            background: #c0392b;
        }
        
        .colica-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .colica-table th {
            background: #2c7fb8;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .colica-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .colica-table tr:last-child td {
            border-bottom: none;
        }
        
        .colica-table tr:hover {
            background: #f8f9fa;
        }
        
        .severity-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }
        
        .severity-high {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .severity-medium {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffe0b2;
        }
        
        .severity-low {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .treatment-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .treatment-clinico {
            background: #bbdefb;
            color: #1565c0;
        }
        
        .treatment-cirurgico {
            background: #ffccbc;
            color: #d84315;
        }
        
        .treatment-medicamento {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        .esquadrao-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #ddd;
            border-radius: 20px;
            background: white;
            color: #666;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            border-color: #2c7fb8;
            color: #2c7fb8;
            background: #e8f4fc;
        }
        
        .colica-details {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #2c7fb8;
        }
        
        .colica-details.active {
            display: block;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #2c7fb8;
            min-width: 150px;
        }
        
        .detail-value {
            flex: 1;
            color: #555;
        }
        
        /* NOVO MODAL PARA REGISTRO DE CÓLICA */
        .colica-form-container {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .severity-indicator {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .severity-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .severity-option:hover {
            transform: translateY(-2px);
        }
        
        .severity-option.selected {
            color: white;
            border-color: transparent;
        }
        
        .severity-option.low.selected {
            background: #2ecc71;
        }
        
        .severity-option.medium.selected {
            background: #f39c12;
        }
        
        .severity-option.high.selected {
            background: #e74c3c;
        }
        
        .treatment-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .treatment-option {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .treatment-option:hover {
            transform: translateY(-2px);
        }
        
        .treatment-option.selected {
            color: white;
            border-color: transparent;
        }
        
        .treatment-option.clinico.selected {
            background: #2196f3;
        }
        
        .treatment-option.cirurgico.selected {
            background: #ff5722;
        }
        
        .treatment-option.medicamento.selected {
            background: #4caf50;
        }
        
        /* NOVO ESTILO PARA BOTÃO DE ADICIONAR À VISITA */
        .btn-add-to-visita {
            background: #9b59b6;
            color: white;
        }
        
        .btn-add-to-visita:hover {
            background: #8e44ad;
        }
        
        /* NOVOS ESTILOS PARA O BALÃO DE CONFIRMAÇÃO PERSONALIZADO */
        .custom-confirm-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .custom-confirm-box {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            animation: slideUp 0.4s ease forwards;
        }
        
        @keyframes slideUp {
            to {
                transform: translateY(0);
            }
        }
        
        .confirm-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 25px 30px;
            text-align: center;
            color: white;
        }
        
        .confirm-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 15px rgba(255, 255, 255, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
        }
        
        .confirm-header h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .confirm-header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .confirm-content {
            padding: 30px;
            text-align: center;
        }
        
        .warning-message {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 25px;
            text-align: left;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-message h4 {
            color: #ff9800;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .confirm-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .confirm-details p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .confirm-details svg {
            color: #e74c3c;
            flex-shrink: 0;
        }
        
        .confirm-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .confirm-btn.cancel {
            background: #ecf0f1;
            color: #34495e;
        }
        
        .confirm-btn.cancel:hover {
            background: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .confirm-btn.delete {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .confirm-btn.delete:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-info {
                text-align: center;
                flex-direction: column;
            }
            
            .actions-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .horse-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .days-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .welcome-title {
                font-size: 2.5rem;
            }
            
            .welcome-subtitle {
                font-size: 1.4rem;
            }
            
            .welcome-user {
                font-size: 1.8rem;
            }
            
            .esquadrao-options {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                text-align: center;
            }
            
            .colica-table {
                display: block;
                overflow-x: auto;
            }
            
            .timeline-container::before {
                left: 15px;
            }
            
            .timeline-item::before {
                left: -20px;
            }
            
            .floating-window {
                min-width: 250px;
                max-width: 300px;
            }
            
            .prescription-icon-btn {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
            }
            
            .confirm-actions {
                flex-direction: column;
            }
            
            .confirm-btn {
                width: 100%;
            }
            
            .colica-stats-grid {
                grid-template-columns: 1fr;
            }
            
            .colica-actions {
                flex-direction: column;
            }
            
            .esquadrao-filter {
                flex-direction: column;
            }
            
            .severity-indicator {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- TELA DE TRANSIÇÃO -->
    <div id="welcomePage">
        <div class="welcome-container">
            <div class="welcome-logo">
                <img src="2-rcg-926x926 (1).jpg" alt="Logo Veterinária">
            </div>
            <h1 class="welcome-title">Bem-vindo(a)</h1>
            <h2 class="welcome-subtitle">ao Vet2°rcg System</h2>
            <div class="welcome-user" id="welcomeUserName"></div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="welcome-message">Carregando seus arquivos...</p>
        </div>
    </div>

    <!-- TELA DE ARQUIVOS -->
    <div id="filesPage">
        <div class="header">
            <div class="logo-section">
                <div class="logo-image-small">
                    <img src="2-rcg-926x926 (1).jpg" alt="Logo Veterinária">
                </div>
                <div class="logo-text">
                    <h1>Vet 2°rcg System</h1>
                    <p>Sistema de Gestão Veterinária</p>
                </div>
            </div>
            <div class="user-info">
                <p>Logado como: <span id="loggedUser">Administrador</span></p>
                <button class="btn-logout" id="btnLogout">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Sair
                </button>
            </div>
        </div>
        
        <div class="main-container">
            <!-- Navegação por abas -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="arquivos">Arquivos de Cavalos</button>
                <button class="nav-tab" data-tab="colicas">Histórico de Cólicas</button>
            </div>
            
            <!-- Aba de Arquivos -->
            <div class="tab-content active" id="arquivosTab">
                <h1 class="page-title">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 13H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 9H9H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Arquivos de Cavalos
                </h1>
                
                <div class="actions-bar">
                    <div class="search-box">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Buscar cavalo...">
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="btnAddHorse">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Adicionar Cavalo
                        </button>
                        <button class="btn btn-secondary" id="btnExportAll">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Exportar Todos
                        </button>
                    </div>
                </div>
                
                <div class="alphabet-filter" id="alphabetFilter">
                    <!-- As letras serão geradas via JavaScript -->
                </div>
                
                <div class="files-grid" id="filesGrid">
                    <!-- Os arquivos serão gerados via JavaScript -->
                </div>
            </div>
            
            <!-- Aba de Histórico de Cólicas -->
            <div class="tab-content" id="colicasTab">
                <h1 class="page-title">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 8V12" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16H12.01" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Histórico de Cólicas
                </h1>
                
                <div class="colica-actions">
                    <button class="btn-colica new" id="btnNovaColica">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 12H19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Nova Cólica
                    </button>
                    <button class="btn-colica" id="btnRelatorioColicas">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 12H18L15 21L9 3L6 12H2" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Gerar Relatório
                    </button>
                </div>
                
                <!-- Filtros por Esquadrão -->
                <div class="esquadrao-filter">
                    <button class="filter-btn active" data-esquadrao="todos">Todos</button>
                    <button class="filter-btn" data-esquadrao="Hipo">Hipo</button>
                    <button class="filter-btn" data-esquadrao="DH">DH</button>
                    <button class="filter-btn" data-esquadrao="Outro">Outros</button>
                </div>
                
                <!-- Estatísticas Gerais -->
                <div class="colica-stats-grid" id="colicaStats">
                    <!-- Estatísticas serão geradas via JavaScript -->
                </div>
                
                <!-- Gráficos -->
                <div class="chart-container">
                    <h3 class="chart-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 20V10" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 20V4" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6 20V14" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Cólicas por Mês (Últimos 6 meses)
                    </h3>
                    <canvas id="colicaChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 6V12L16 14" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Distribuição por Gravidade
                    </h3>
                    <canvas id="severityChart"></canvas>
                </div>
                
                <!-- Tabela de Histórico -->
                <div class="colica-control-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12L11 14L15 10" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Histórico de Registros
                    </h3>
                    <table class="colica-table" id="colicaTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Cavalo</th>
                                <th>Esquadrão</th>
                                <th>Gravidade</th>
                                <th>Tratamento</th>
                                <th>Veterinário</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Conteúdo será preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Adicionar Cavalo -->
    <div class="modal" id="horseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Novo Cavalo</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <form id="horseForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="horseName">Animal</label>
                        <input type="text" id="horseName" required>
                    </div>
                    <div class="form-group">
                        <label for="horseId">Identificação</label>
                        <input type="text" id="horseId" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horseColor">Pelagem</label>
                        <input type="text" id="horseColor" required>
                    </div>
                    <div class="form-group">
                        <label for="horseSex">Sexo</label>
                        <select id="horseSex" required>
                            <option value="">Selecione</option>
                            <option value="Macho">Macho</option>
                            <option value="Fêmea">Fêmea</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Esquadrão</label>
                    <div class="esquadrao-options">
                        <div class="esquadrao-option" data-value="Hipo">Hipo</div>
                        <div class="esquadrao-option" data-value="DH">D.H</div>
                        <div class="esquadrao-option" data-value="Outro">Outro</div>
                    </div>
                    <div class="esquadrao-origem" id="esquadraoOrigem">
                        <label for="horseOrigem">Digite a origem do animal</label>
                        <input type="text" id="horseOrigem">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="horseHistory">Histórico Médico</label>
                    <textarea id="horseHistory" rows="4"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="btnCancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Ficha</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Detalhes do Cavalo -->
    <div class="modal" id="horseDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="horseDetailTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Detalhes do Cavalo
                </h2>
                <button class="close-modal" id="closeDetailModal">&times;</button>
            </div>
            
            <!-- BOTÃO DA SERINGA PARA PRESCRIÇÕES -->
            <button class="prescription-icon-btn" id="prescriptionIconBtn" title="Visualizar Prescrições Médicas">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.14 12.94C18.8 12.94 18.5 12.64 18.5 12.3V10.83C18.5 9.22 17.22 7.94 15.61 7.94H14.15C13.81 7.94 13.51 7.64 13.51 7.3C13.51 6.96 13.81 6.66 14.15 6.66H15.61C17.78 6.66 19.5 8.38 19.5 10.55V12.02C19.5 12.36 19.2 12.66 18.86 12.66H19.14V12.94Z" fill="white"/>
                    <path d="M5 12.94C4.66 12.94 4.36 12.64 4.36 12.3V10.83C4.36 9.22 5.64 7.94 7.25 7.94H8.71C9.05 7.94 9.35 7.64 9.35 7.3C9.35 6.96 9.05 6.66 8.71 6.66H7.25C5.08 6.66 3.36 8.38 3.36 10.55V12.02C3.36 12.36 3.66 12.66 4 12.66H5V12.94Z" fill="white"/>
                    <path d="M16.21 10.75H7.79C5.65 10.75 4.25 9.35 4.25 7.21V7.14C4.25 4.99 5.65 3.59 7.79 3.59H16.2C18.34 3.59 19.74 4.99 19.74 7.14V7.21C19.75 9.35 18.35 10.75 16.21 10.75ZM7.79 4.84C6.5 4.84 5.5 5.84 5.5 7.14V7.21C5.5 8.5 6.5 9.5 7.79 9.5H16.2C17.49 9.5 18.49 8.5 18.49 7.21V7.14C18.49 5.85 17.49 4.85 16.2 4.85H7.79V4.84Z" fill="white"/>
                    <path d="M12 14.75C11.59 14.75 11.25 14.41 11.25 14V11C11.25 10.59 11.59 10.25 12 10.25C12.41 10.25 12.75 10.59 12.75 11V14C12.75 14.41 12.41 14.75 12 14.75Z" fill="white"/>
                    <path d="M12 18.75C11.59 18.75 11.25 18.41 11.25 18V15C11.25 14.59 11.59 14.25 12 14.25C12.41 14.25 12.75 14.59 12.75 15V18C12.75 18.41 12.41 18.75 12 18.75Z" fill="white"/>
                    <path d="M15 22.75H9C4.59 22.75 2.25 20.41 2.25 16V14C2.25 13.04 3.04 12.25 4 12.25H20C20.96 12.25 21.75 13.04 21.75 14V16C21.75 20.41 19.41 22.75 15 22.75ZM4 13.75C3.86 13.75 3.75 13.86 3.75 14V16C3.75 19.58 5.42 21.25 9 21.25H15C18.58 21.25 20.25 19.58 20.25 16V14C20.25 13.86 20.14 13.75 20 13.75H4Z" fill="white"/>
                </svg>
            </button>
            
            <div class="horse-detail-grid" id="horseDetailContent">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="btnCloseDetail">Fechar</button>
                <button type="button" class="btn btn-primary" id="btnEditHorse">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Editar Ficha
                </button>
                <button type="button" class="btn btn-delete-horse" id="btnDeleteHorse">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Excluir Cavalo
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Cólica -->
    <div class="modal" id="colicaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Registrar Nova Cólica</h2>
                <button class="close-modal" id="closeColicaModal">&times;</button>
            </div>
            
            <div class="colica-form-container">
                <form id="colicaForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="colicaHorse">Cavalo</label>
                            <select id="colicaHorse" required>
                                <option value="">Selecione o cavalo</option>
                                <!-- Opções serão preenchidas via JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="colicaDate">Data do Ocorrido</label>
                            <input type="date" id="colicaDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="colicaTime">Hora</label>
                            <input type="time" id="colicaTime" required>
                        </div>
                        <div class="form-group">
                            <label for="colicaVeterinario">Veterinário Responsável</label>
                            <input type="text" id="colicaVeterinario" required placeholder="Nome do veterinário">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Gravidade da Cólica</label>
                        <div class="severity-indicator">
                            <div class="severity-option low" data-severity="baixa">
                                <div style="font-size: 20px;">🟢</div>
                                <div>Baixa</div>
                                <div style="font-size: 12px; color: #666;">Leve</div>
                            </div>
                            <div class="severity-option medium" data-severity="media">
                                <div style="font-size: 20px;">🟡</div>
                                <div>Média</div>
                                <div style="font-size: 12px; color: #666;">Moderada</div>
                            </div>
                            <div class="severity-option high" data-severity="alta">
                                <div style="font-size: 20px;">🔴</div>
                                <div>Alta</div>
                                <div style="font-size: 12px; color: #666;">Grave</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Tratamento Aplicado</label>
                        <div class="treatment-options">
                            <div class="treatment-option clinico" data-treatment="clinico">
                                Clínico
                            </div>
                            <div class="treatment-option cirurgico" data-treatment="cirurgico">
                                Cirúrgico
                            </div>
                            <div class="treatment-option medicamento" data-treatment="medicamento">
                                Medicamento
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="colicaSintomas">Sintomas Observados</label>
                        <textarea id="colicaSintomas" rows="3" placeholder="Descreva os sintomas observados..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="colicaTratamentoDetalhes">Detalhes do Tratamento</label>
                        <textarea id="colicaTratamentoDetalhes" rows="3" placeholder="Descreva o tratamento aplicado..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="colicaObservacoes">Observações / Recomendações</label>
                        <textarea id="colicaObservacoes" rows="3" placeholder="Observações importantes..."></textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="btnCancelColica">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Registro</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- NOVO BALÃO DE CONFIRMAÇÃO PERSONALIZADO -->
    <div class="custom-confirm-overlay" id="customConfirmOverlay">
        <div class="custom-confirm-box" id="customConfirmBox">
            <div class="confirm-header">
                <div class="confirm-icon">⚠️</div>
                <h3>CONFIRMAR EXCLUSÃO</h3>
                <p>Você está prestes a excluir permanentemente uma ficha</p>
            </div>
            <div class="confirm-content">
                <div class="warning-message">
                    <h4>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9V14" stroke="#ff9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 17H12.01" stroke="#ff9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#ff9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    ATENÇÃO! AÇÃO IRREVERSÍVEL
                    </h4>
                    <p>Esta ação não pode ser desfeita. Todos os dados do cavalo serão perdidos permanentemente.</p>
                </div>
                
                <div class="confirm-details">
                    <p>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <strong>Serão excluídos permanentemente:</strong>
                    </p>
                    <p style="margin-left: 28px;">• Ficha completa do animal</p>
                    <p style="margin-left: 28px;">• Histórico médico registrado</p>
                    <p style="margin-left: 28px;">• Prescrições e tratamentos</p>
                    <p style="margin-left: 28px;">• Registros de visitas veterinárias</p>
                </div>
                
                <div class="confirm-actions">
                    <button class="confirm-btn cancel" id="confirmCancelBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        CANCELAR
                    </button>
                    <button class="confirm-btn delete" id="confirmDeleteBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        EXCLUIR PERMANENTEMENTE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== DADOS DOS CAVALOS E CÓLICAS ==========
        // Função para carregar dados do localStorage
        function loadHorsesFromStorage() {
            const storedHorses = localStorage.getItem('vetSystemHorses');
            if (storedHorses) {
                return JSON.parse(storedHorses);
            } else {
                // Dados padrão se não houver nada salvo
                return [
                    { 
                        id: 1, 
                        name: "Gastador", 
                        color: "Alazão", 
                        sex: "Macho", 
                        esquadrao: "Hipo",
                        origem: "",
                        history: [
                            { date: "15/11/2025", description: "Pós cirúrgico. Última consulta" },
                            { date: "10/11/2025", description: "Aplicação de vacina contra influenza" },
                            { date: "05/11/2025", description: "Exame de sangue realizado - resultados normais" }
                        ],
                        prescriptions: [
                            {
                                id: 1,
                                medication: "Anti-inflamatório",
                                dosage: "1 comprimido",
                                frequency: "2 vezes ao dia",
                                duration: 7,
                                startDate: "2025-01-15",
                                medicationDays: [
                                    { day: 1, status: "applied" },
                                    { day: 2, status: "applied" },
                                    { day: 3, status: "not-applied" },
                                    { day: 4, status: null },
                                    { day: 5, status: null },
                                    { day: 6, status: null },
                                    { day: 7, status: null }
                                ]
                            },
                            {
                                id: 2,
                                medication: "Vitamina E",
                                dosage: "500mg",
                                frequency: "1 vez ao dia",
                                duration: 14,
                                startDate: "2025-01-10",
                                medicationDays: [
                                    { day: 1, status: "applied" },
                                    { day: 2, status: "applied" },
                                    { day: 3, status: "applied" },
                                    { day: 4, status: "applied" },
                                    { day: 5, status: "applied" },
                                    { day: 6, status: "applied" },
                                    { day: 7, status: "applied" },
                                    { day: 8, status: "not-applied" },
                                    { day: 9, status: null },
                                    { day: 10, status: null },
                                    { day: 11, status: null },
                                    { day: 12, status: null },
                                    { day: 13, status: null },
                                    { day: 14, status: null }
                                ]
                            }
                        ],
                        protocolo: "Quarentena - PITE",
                        selectedForVisit: false
                    },
                    { 
                        id: 2, 
                        name: "Afeição", 
                        color: "Tordilho", 
                        sex: "Fêmea", 
                        esquadrao: "DH",
                        origem: "",
                        history: [
                            { date: "20/11/2025", description: "Problema articular tratado. Controle semestral." },
                            { date: "15/10/2025", description: "Aplicação de suplemento articular" },
                            { date: "26/11/2025", description: "Consulta de rotina - saúde estável" }
                        ],
                        prescriptions: [
                            {
                                id: 1,
                                medication: "Suplemento articular",
                                dosage: "2 comprimidos",
                                frequency: "1 vez ao dia",
                                duration: 30,
                                startDate: "2025-01-01",
                                medicationDays: Array.from({length: 30}, (_, i) => ({ 
                                    day: i + 1, 
                                    status: i < 14 ? "applied" : null 
                                }))
                            }
                        ],
                        protocolo: "Suplementação (Óleo)",
                        selectedForVisit: false
                    }
                ];
            }
        }
        
        // Função para carregar cólicas do localStorage
        function loadColicasFromStorage() {
            const storedColicas = localStorage.getItem('vetSystemColicas');
            if (storedColicas) {
                return JSON.parse(storedColicas);
            } else {
                // Dados de exemplo para cólicas
                const hoje = new Date();
                const umMesAtras = new Date();
                umMesAtras.setMonth(hoje.getMonth() - 1);
                
                return [
                    {
                        id: 1,
                        horseId: 1,
                        horseName: "Gastador",
                        esquadrao: "Hipo",
                        date: formatDate(umMesAtras),
                        time: "14:30",
                        severity: "alta",
                        treatment: ["clinico", "medicamento"],
                        sintomas: "Inquietação, sudação, olhar para o flanco, tentativas de deitar e rolar",
                        tratamentoDetalhes: "Administração de analgésico e antiespasmódico. Repouso absoluto.",
                        observacoes: "Monitorar ingestão de água e fezes. Reavaliação em 6 horas.",
                        veterinario: "Dr. Carlos Silva",
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        horseId: 2,
                        horseName: "Afeição",
                        esquadrao: "DH",
                        date: formatDate(hoje),
                        time: "09:15",
                        severity: "media",
                        treatment: ["medicamento"],
                        sintomas: "Leve desconforto abdominal, diminuição do apetite",
                        tratamentoDetalhes: "Administração de óleo mineral via sonda nasogástrica",
                        observacoes: "Dieta líquida por 24 horas. Retornar alimentação normal gradualmente.",
                        veterinario: "Dra. Maria Santos",
                        createdAt: new Date().toISOString()
                    }
                ];
            }
        }
        
        // Função para formatar data
        function formatDate(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Função para salvar dados no localStorage
        function saveHorsesToStorage() {
            localStorage.setItem('vetSystemHorses', JSON.stringify(horses));
        }
        
        // Função para salvar cólicas no localStorage
        function saveColicasToStorage() {
            localStorage.setItem('vetSystemColicas', JSON.stringify(colicas));
        }
        
        // Carregar dados iniciais
        let horses = loadHorsesFromStorage();
        let colicas = loadColicasFromStorage();
        
        // ========== ELEMENTOS DO DOM ==========
        // Tela de transição
        const welcomePage = document.getElementById('welcomePage');
        const filesPage = document.getElementById('filesPage');
        const welcomeUserName = document.getElementById('welcomeUserName');
        
        // Arquivos
        const alphabetFilter = document.getElementById('alphabetFilter');
        const filesGrid = document.getElementById('filesGrid');
        const searchInput = document.getElementById('searchInput');
        const btnAddHorse = document.getElementById('btnAddHorse');
        const btnExportAll = document.getElementById('btnExportAll');
        const horseModal = document.getElementById('horseModal');
        const closeModal = document.getElementById('closeModal');
        const btnCancel = document.getElementById('btnCancel');
        const horseForm = document.getElementById('horseForm');
        const btnLogout = document.getElementById('btnLogout');
        const loggedUser = document.getElementById('loggedUser');
        
        // Detalhes do cavalo
        const horseDetailModal = document.getElementById('horseDetailModal');
        const horseDetailTitle = document.getElementById('horseDetailTitle');
        const horseDetailContent = document.getElementById('horseDetailContent');
        const closeDetailModal = document.getElementById('closeDetailModal');
        const btnCloseDetail = document.getElementById('btnCloseDetail');
        const btnEditHorse = document.getElementById('btnEditHorse');
        const btnDeleteHorse = document.getElementById('btnDeleteHorse');
        const prescriptionIconBtn = document.getElementById('prescriptionIconBtn');
        
        // Esquadrão
        const esquadraoOptions = document.querySelectorAll('.esquadrao-option');
        const esquadraoOrigem = document.getElementById('esquadraoOrigem');
        
        // Cólicas
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const btnNovaColica = document.getElementById('btnNovaColica');
        const btnRelatorioColicas = document.getElementById('btnRelatorioColicas');
        const colicaModal = document.getElementById('colicaModal');
        const closeColicaModalBtn = document.getElementById('closeColicaModal'); // CORREÇÃO: Mudei o nome aqui
        const btnCancelColica = document.getElementById('btnCancelColica');
        const colicaForm = document.getElementById('colicaForm');
        const colicaStats = document.getElementById('colicaStats');
        const colicaTable = document.getElementById('colicaTable').querySelector('tbody');
        const esquadraoFilterBtns = document.querySelectorAll('.filter-btn');
        
        // Gráficos
        let colicaChart = null;
        let severityChart = null;
        
        // NOVO BALÃO DE CONFIRMAÇÃO
        const customConfirmOverlay = document.getElementById('customConfirmOverlay');
        const customConfirmBox = document.getElementById('customConfirmBox');
        const confirmCancelBtn = document.getElementById('confirmCancelBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        // Variáveis globais
        let currentHorseId = null;
        let currentFilter = 'all';
        let currentUser = '';
        let isEditingHistory = false;
        let activeWindows = [];
        let horseToDelete = null;
        let currentEsquadraoFilter = 'todos';
        let selectedSeverity = null;
        let selectedTreatments = [];
        
        // ========== VERIFICAÇÃO DE LOGIN ==========
        function checkLogin() {
            const storedUser = localStorage.getItem('currentUser');
            const storedRole = localStorage.getItem('userRole');
            
            if (!storedUser || !storedRole) {
                // Redirecionar para a página de login se não estiver logado
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }
        
        // ========== FUNÇÕES DE TRANSIÇÃO ==========
        function showWelcomePage() {
            welcomePage.style.display = 'flex';
            welcomeUserName.textContent = currentUser;
            
            setTimeout(function() {
                showFilesPage();
            }, 4500);
        }
        
        function showFilesPage() {
            welcomePage.style.display = 'none';
            filesPage.style.display = 'block';
            loggedUser.textContent = currentUser;
            generateAlphabetFilter();
            renderHorses();
            renderColicas();
            renderColicaStats();
            initCharts();
        }
        
        function showLoginPage() {
            window.location.href = 'login.html';
        }
        
        // ========== FUNÇÕES DA TELA DE ARQUIVOS ==========
        function generateAlphabetFilter() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            alphabetFilter.innerHTML = '';
            
            // Botão "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'letter-btn active';
            allButton.textContent = 'TODOS';
            allButton.addEventListener('click', () => filterHorsesByLetter('all'));
            alphabetFilter.appendChild(allButton);
            
            // Botões para cada letra
            letters.forEach(letter => {
                const button = document.createElement('button');
                button.className = 'letter-btn';
                button.textContent = letter;
                button.addEventListener('click', () => filterHorsesByLetter(letter));
                alphabetFilter.appendChild(button);
            });
        }
        
        function filterHorsesByLetter(letter) {
            currentFilter = letter;
            
            document.querySelectorAll('.letter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.letter-btn').forEach(btn => {
                if (btn.textContent === letter || (letter === 'all' && btn.textContent === 'TODOS')) {
                    btn.classList.add('active');
                }
            });
            
            renderHorses();
        }
        
        function renderHorses() {
            filesGrid.innerHTML = '';
            
            let filteredHorses = [...horses];
            
            // Aplicar filtro alfabético
            if (currentFilter !== 'all') {
                filteredHorses = filteredHorses.filter(horse => 
                    horse.name.toUpperCase().startsWith(currentFilter)
                );
            }
            
            // Aplicar filtro de busca
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredHorses = filteredHorses.filter(horse => 
                    horse.name.toLowerCase().includes(searchTerm) ||
                    horse.color.toLowerCase().includes(searchTerm) ||
                    horse.esquadrao.toLowerCase().includes(searchTerm)
                );
            }
            
            // Ordenar alfabeticamente
            filteredHorses.sort((a, b) => a.name.localeCompare(b.name));
            
            if (filteredHorses.length === 0) {
                filesGrid.innerHTML = `
                    <div class="no-results">
                        <h3>Nenhum cavalo encontrado</h3>
                        <p>Tente ajustar seus filtros de busca</p>
                    </div>
                `;
                return;
            }
            
            // Renderizar cada cavalo
            filteredHorses.forEach(horse => {
                const horseCard = document.createElement('div');
                horseCard.className = 'file-card';
                
                // Determinar a classe do badge baseado no esquadrão
                let badgeClass = '';
                if (horse.esquadrao === 'Hipo') badgeClass = 'hipo';
                else if (horse.esquadrao === 'DH') badgeClass = 'dh';
                else badgeClass = 'outro';
                
                horseCard.innerHTML = `
                    <h3 class="horse-name">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        ${horse.name}
                    </h3>
                    <div class="horse-details">
                        <div><strong>Cor:</strong> ${horse.color}</div>
                        <div><strong>Sexo:</strong> ${horse.sex}</div>
                        <div><strong>Esquadrão:</strong> 
                            <span class="esquadrao-badge ${badgeClass}">
                                ${horse.esquadrao}${horse.origem ? ` (${horse.origem})` : ''}
                            </span>
                        </div>
                        <div><strong>Protocolo:</strong> ${horse.protocolo || 'Nenhum'}</div>
                    </div>
                    <div class="file-actions">
                        <button class="btn-small btn-edit" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Editar
                        </button>
                        <button class="btn-small btn-pdf" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            PDF
                        </button>
                        <button class="btn-small btn-delete-horse" data-id="${horse.id}">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Excluir
                        </button>
                    </div>
                `;
                filesGrid.appendChild(horseCard);
                
                // Adicionar evento de clique no card
                horseCard.addEventListener('click', (e) => {
                    if (!e.target.closest('.file-actions')) {
                        openHorseDetail(horse.id);
                    }
                });
            });
            
            // Adicionar event listeners para os botões
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    redirectToFicha(horseId);
                });
            });
            
            document.querySelectorAll('.btn-pdf').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    exportToPDF(horseId);
                });
            });
            
            document.querySelectorAll('.btn-delete-horse').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const horseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    showCustomConfirm(horseId);
                });
            });
        }
        
        function redirectToFicha(horseId) {
            localStorage.setItem('currentHorseId', horseId);
            window.location.href = 'ficha.html';
        }
        
        // ========== FUNÇÕES DA ABA DE CÓLICAS ==========
        function renderColicas() {
            colicaTable.innerHTML = '';
            
            let filteredColicas = [...colicas];
            
            // Aplicar filtro de esquadrão
            if (currentEsquadraoFilter !== 'todos') {
                filteredColicas = filteredColicas.filter(colica => 
                    colica.esquadrao === currentEsquadraoFilter
                );
            }
            
            // Ordenar por data (mais recente primeiro)
            filteredColicas.sort((a, b) => {
                const dateA = a.date.split('/').reverse().join('-');
                const dateB = b.date.split('/').reverse().join('-');
                return new Date(dateB + 'T' + b.time) - new Date(dateA + 'T' + a.time);
            });
            
            if (filteredColicas.length === 0) {
                colicaTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <h3>Nenhum registro de cólica encontrado</h3>
                            <p>Clique em "Nova Cólica" para registrar o primeiro caso</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Renderizar cada registro
            filteredColicas.forEach((colica, index) => {
                const severityClass = `severity-${colica.severity}`;
                const severityText = colica.severity === 'alta' ? 'Alta' : 
                                   colica.severity === 'media' ? 'Média' : 'Baixa';
                
                // Gerar badges de tratamento
                let treatmentBadges = '';
                colica.treatment.forEach(treatment => {
                    const treatmentText = treatment === 'clinico' ? 'Clínico' :
                                        treatment === 'cirurgico' ? 'Cirúrgico' : 'Medicamento';
                    const treatmentClass = `treatment-${treatment}`;
                    treatmentBadges += `<span class="treatment-badge ${treatmentClass}">${treatmentText}</span>`;
                });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${colica.date} ${colica.time}</td>
                    <td><strong>${colica.horseName}</strong></td>
                    <td>
                        <span class="esquadrao-badge ${colica.esquadrao === 'Hipo' ? 'hipo' : colica.esquadrao === 'DH' ? 'dh' : 'outro'}">
                            ${colica.esquadrao}
                        </span>
                    </td>
                    <td>
                        <span class="severity-badge ${severityClass}">
                            ${severityText}
                        </span>
                    </td>
                    <td>${treatmentBadges}</td>
                    <td>${colica.veterinario}</td>
                `;
                
                // Adicionar linha de detalhes
                const detailRow = document.createElement('tr');
                detailRow.className = 'colica-details';
                detailRow.innerHTML = `
                    <td colspan="6">
                        <div class="detail-row">
                            <div class="detail-label">Sintomas:</div>
                            <div class="detail-value">${colica.sintomas}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Tratamento:</div>
                            <div class="detail-value">${colica.tratamentoDetalhes}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Observações:</div>
                            <div class="detail-value">${colica.observacoes}</div>
                        </div>
                    </td>
                `;
                
                colicaTable.appendChild(row);
                colicaTable.appendChild(detailRow);
                
                // Adicionar evento para expandir detalhes
                row.addEventListener('click', () => {
                    detailRow.classList.toggle('active');
                });
            });
        }
        
        function renderColicaStats() {
            // Calcular estatísticas
            const totalColicas = colicas.length;
            const colicasAlta = colicas.filter(c => c.severity === 'alta').length;
            const colicasMedia = colicas.filter(c => c.severity === 'media').length;
            const colicasBaixa = colicas.filter(c => c.severity === 'baixa').length;
            
            // Cálculo de média mensal (últimos 6 meses)
            const ultimos6Meses = getUltimos6Meses();
            const colicasPorMes = {};
            
            colicas.forEach(colica => {
                const mesAno = extractMesAno(colica.date);
                if (ultimos6Meses.includes(mesAno)) {
                    colicasPorMes[mesAno] = (colicasPorMes[mesAno] || 0) + 1;
                }
            });
            
            const mediaMensal = Object.values(colicasPorMes).reduce((a, b) => a + b, 0) / 6;
            
            // Percentual de tratamento cirúrgico
            const cirurgias = colicas.filter(c => c.treatment.includes('cirurgico')).length;
            const percentualCirurgico = totalColicas > 0 ? ((cirurgias / totalColicas) * 100).toFixed(1) : 0;
            
            colicaStats.innerHTML = `
                <div class="stat-card severity-high">
                    <div class="stat-value">${totalColicas}</div>
                    <div class="stat-label">Total de Cólicas</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">Registros totais</div>
                </div>
                <div class="stat-card severity-high">
                    <div class="stat-value">${colicasAlta}</div>
                    <div class="stat-label">Cólicas Graves</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">Alta gravidade</div>
                </div>
                <div class="stat-card severity-medium">
                    <div class="stat-value">${mediaMensal.toFixed(1)}</div>
                    <div class="stat-label">Média Mensal</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">Últimos 6 meses</div>
                </div>
                <div class="stat-card severity-low">
                    <div class="stat-value">${percentualCirurgico}%</div>
                    <div class="stat-label">Cirúrgicas</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">Necessitaram cirurgia</div>
                </div>
            `;
        }
        
        function getUltimos6Meses() {
            const meses = [];
            const hoje = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                const mes = String(data.getMonth() + 1).padStart(2, '0');
                const ano = data.getFullYear();
                meses.push(`${mes}/${ano}`);
            }
            
            return meses;
        }
        
        function extractMesAno(dataStr) {
            const partes = dataStr.split('/');
            if (partes.length === 3) {
                return `${partes[1]}/${partes[2]}`;
            }
            return '';
        }
        
        function initCharts() {
            // Destruir gráficos existentes
            if (colicaChart) {
                colicaChart.destroy();
            }
            if (severityChart) {
                severityChart.destroy();
            }
            
            // Dados para gráfico de cólicas por mês
            const ultimos6Meses = getUltimos6Meses();
            const mesesLabels = ultimos6Meses.map(mes => {
                const [mesNum, ano] = mes.split('/');
                const mesesNomes = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 
                                   'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dec'];
                return `${mesesNomes[parseInt(mesNum) - 1]}/${ano.substring(2)}`;
            });
            
            const colicasPorMesData = new Array(6).fill(0);
            colicas.forEach(colica => {
                const mesAno = extractMesAno(colica.date);
                const index = ultimos6Meses.indexOf(mesAno);
                if (index !== -1) {
                    colicasPorMesData[index]++;
                }
            });
            
            // Gráfico de linha - Cólicas por mês
            const colicaChartCtx = document.getElementById('colicaChart').getContext('2d');
            colicaChart = new Chart(colicaChartCtx, {
                type: 'line',
                data: {
                    labels: mesesLabels,
                    datasets: [{
                        label: 'Número de Cólicas',
                        data: colicasPorMesData,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#e74c3c',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Número de Cólicas'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Mês'
                            }
                        }
                    }
                }
            });
            
            // Dados para gráfico de pizza - Distribuição por gravidade
            const colicasAlta = colicas.filter(c => c.severity === 'alta').length;
            const colicasMedia = colicas.filter(c => c.severity === 'media').length;
            const colicasBaixa = colicas.filter(c => c.severity === 'baixa').length;
            
            // Gráfico de pizza - Distribuição por gravidade
            const severityChartCtx = document.getElementById('severityChart').getContext('2d');
            severityChart = new Chart(severityChartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Alta Gravidade', 'Média Gravidade', 'Baixa Gravidade'],
                    datasets: [{
                        data: [colicasAlta, colicasMedia, colicasBaixa],
                        backgroundColor: [
                            '#e74c3c',
                            '#f39c12',
                            '#2ecc71'
                        ],
                        borderColor: [
                            '#c0392b',
                            '#d35400',
                            '#27ae60'
                        ],
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Lógica para filtro de esquadrão
        function filterByEsquadrao(esquadrao) {
            currentEsquadraoFilter = esquadrao;
            
            // Atualizar botões ativos
            esquadraoFilterBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-esquadrao') === esquadrao) {
                    btn.classList.add('active');
                }
            });
            
            renderColicas();
        }
        
        // Abrir modal para nova cólica
        function openColicaModal() {
            // Preencher select de cavalos
            const horseSelect = document.getElementById('colicaHorse');
            horseSelect.innerHTML = '<option value="">Selecione o cavalo</option>';
            
            horses.forEach(horse => {
                const option = document.createElement('option');
                option.value = horse.id;
                option.textContent = `${horse.name} - ${horse.esquadrao}`;
                horseSelect.appendChild(option);
            });
            
            // Definir data atual como padrão
            const hoje = new Date();
            const dataFormatada = hoje.toISOString().split('T')[0];
            document.getElementById('colicaDate').value = dataFormatada;
            
            // Resetar seleções
            selectedSeverity = null;
            selectedTreatments = [];
            
            document.querySelectorAll('.severity-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelectorAll('.treatment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            colicaModal.style.display = 'flex';
        }
        
        // CORREÇÃO: Renomeei a função para evitar conflito
        function closeColicaModalFunc() {
            colicaModal.style.display = 'none';
        }
        
        // Salvar nova cólica
        function saveColica(e) {
            e.preventDefault();
            
            const horseId = parseInt(document.getElementById('colicaHorse').value);
            const date = document.getElementById('colicaDate').value;
            const time = document.getElementById('colicaTime').value;
            const veterinario = document.getElementById('colicaVeterinario').value;
            const sintomas = document.getElementById('colicaSintomas').value;
            const tratamentoDetalhes = document.getElementById('colicaTratamentoDetalhes').value;
            const observacoes = document.getElementById('colicaObservacoes').value;
            
            // Validações
            if (!horseId) {
                alert('Selecione um cavalo!');
                return;
            }
            
            if (!selectedSeverity) {
                alert('Selecione a gravidade da cólica!');
                return;
            }
            
            if (selectedTreatments.length === 0) {
                alert('Selecione pelo menos um tipo de tratamento!');
                return;
            }
            
            if (!veterinario.trim()) {
                alert('Informe o nome do veterinário responsável!');
                return;
            }
            
            // Encontrar o cavalo
            const horse = horses.find(h => h.id === horseId);
            if (!horse) {
                alert('Cavalo não encontrado!');
                return;
            }
            
            // Formatando a data
            const dateParts = date.split('-');
            const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            
            // Criar novo registro
            const novaColica = {
                id: colicas.length > 0 ? Math.max(...colicas.map(c => c.id)) + 1 : 1,
                horseId: horseId,
                horseName: horse.name,
                esquadrao: horse.esquadrao,
                date: formattedDate,
                time: time,
                severity: selectedSeverity,
                treatment: selectedTreatments,
                sintomas: sintomas,
                tratamentoDetalhes: tratamentoDetalhes,
                observacoes: observacoes,
                veterinario: veterinario,
                createdAt: new Date().toISOString()
            };
            
            // Adicionar à lista
            colicas.push(novaColica);
            
            // Salvar no localStorage
            saveColicasToStorage();
            
            // Fechar modal e atualizar view
            closeColicaModalFunc();
            renderColicas();
            renderColicaStats();
            initCharts();
            
            alert('Registro de cólica salvo com sucesso!');
            
            // Atualizar histórico do cavalo
            const historyEntry = {
                date: formattedDate,
                description: `Cólica registrada - Gravidade: ${selectedSeverity}. ${sintomas.substring(0, 50)}...`
            };
            
            if (!horse.history) {
                horse.history = [];
            }
            horse.history.unshift(historyEntry);
            saveHorsesToStorage();
        }
        
        // Gerar relatório de cólicas
        function gerarRelatorioColicas() {
            // Em um sistema real, aqui geraríamos um PDF
            // Por enquanto, vamos mostrar um resumo
            
            const totalColicas = colicas.length;
            const colicasAlta = colicas.filter(c => c.severity === 'alta').length;
            const colicasMedia = colicas.filter(c => c.severity === 'media').length;
            const colicasBaixa = colicas.filter(c => c.severity === 'baixa').length;
            
            const relatorio = `
                RELATÓRIO DE CÓLICAS - VET 2°RCG SYSTEM
                =========================================
                
                RESUMO GERAL:
                - Total de cólicas registradas: ${totalColicas}
                - Cólicas de alta gravidade: ${colicasAlta}
                - Cólicas de média gravidade: ${colicasMedia}
                - Cólicas de baixa gravidade: ${colicasBaixa}
                
                DISTRIBUIÇÃO POR ESQUADRÃO:
                ${getDistribuicaoPorEsquadrao()}
                
                ÚLTIMOS REGISTROS:
                ${getUltimosRegistros()}
                
                RECOMENDAÇÕES:
                1. Monitorar alimentação dos cavalos com histórico de cólicas
                2. Revisar protocolos de ração e suplementação
                3. Aumentar vigilância nos meses com maior incidência
                4. Manter registros detalhados para análise de padrões
                
                Gerado em: ${new Date().toLocaleDateString('pt-BR')}
                Responsável: ${currentUser}
            `;
            
            alert('Relatório gerado! Em um sistema real, isso criaria um arquivo PDF.\n\n' + relatorio);
        }
        
        function getDistribuicaoPorEsquadrao() {
            const distribuicao = {};
            colicas.forEach(colica => {
                distribuicao[colica.esquadrao] = (distribuicao[colica.esquadrao] || 0) + 1;
            });
            
            let resultado = '';
            for (const [esquadrao, count] of Object.entries(distribuicao)) {
                const percentual = ((count / colicas.length) * 100).toFixed(1);
                resultado += `- ${esquadrao}: ${count} (${percentual}%)\n`;
            }
            return resultado;
        }
        
        function getUltimosRegistros() {
            const ultimas = colicas.slice(0, 5);
            let resultado = '';
            ultimas.forEach(colica => {
                resultado += `- ${colica.date}: ${colica.horseName} (${colica.severity})\n`;
            });
            return resultado;
        }
        
        // ========== FUNÇÕES DE NAVEGAÇÃO ==========
        function switchTab(tabName) {
            // Atualizar botões de navegação
            navTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Atualizar conteúdo das abas
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}Tab`) {
                    content.classList.add('active');
                    
                    // Se for a aba de cólicas, atualizar gráficos
                    if (tabName === 'colicas') {
                        setTimeout(() => {
                            initCharts();
                        }, 100);
                    }
                }
            });
        }
        
        // ========== NOVO BALÃO DE CONFIRMAÇÃO PERSONALIZADO ==========
        function showCustomConfirm(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            horseToDelete = horseId;
            
            const confirmDetails = customConfirmBox.querySelector('.confirm-details');
            confirmDetails.innerHTML = `
                <p>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 8V12" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16H12.01" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <strong>Você está excluindo o cavalo:</strong>
                </p>
                <p style="margin-left: 28px; font-size: 16px; color: #e74c3c; font-weight: bold;">${horse.name}</p>
                <p style="margin-left: 28px;">• ${horse.color} - ${horse.sex}</p>
                <p style="margin-left: 28px;">• Esquadrão: ${horse.esquadrao}</p>
            `;
            
            customConfirmOverlay.style.display = 'flex';
        }
        
        function hideCustomConfirm() {
            customConfirmOverlay.style.display = 'none';
            horseToDelete = null;
        }
        
        function confirmDelete() {
            if (horseToDelete) {
                deleteHorse(horseToDelete);
                hideCustomConfirm();
            }
        }
        
        // ========== FUNÇÕES RESTANTES ==========
        function openHorseDetail(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            currentHorseId = horseId;
            horseDetailTitle.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 16H9M14 12H11M12 21C12.9465 21 13.8734 20.7716 14.7087 20.3343C15.544 19.897 16.2623 19.2643 16.8 18.492C17.7895 17.1277 19.8333 14.8 21 13C21.3333 12.3333 22 10.8 22 8.5C22 5.5 20.5 3 17.5 3C15.8333 3 14.5 4.5 14.5 4.5C14.5 4.5 13.5 3 11.5 3C9.5 3 8.5 4 8.5 6C8.5 6 7.5 5 5.5 5C3.5 5 2 7 2 9.5C2 12.5 3.5 14.5 5.5 16.5C7.5 18.5 9.66667 19.3333 11 19.5C11.5 19.6 12 19.5 12 19.5Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Detalhes - ${horse.name}
            `;
            
            let badgeClass = '';
            if (horse.esquadrao === 'Hipo') badgeClass = 'hipo';
            else if (horse.esquadrao === 'DH') badgeClass = 'dh';
            else badgeClass = 'outro';
            
            let detailContent = `
                <div class="detail-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Informações Básicas
                    </h3>
                    <div class="detail-info">
                        <p><strong>Nome:</strong> ${horse.name}</p>
                        <p><strong>Identificação:</strong> ${horse.id}</p>
                        <p><strong>Cor:</strong> ${horse.color}</p>
                        <p><strong>Sexo:</strong> ${horse.sex}</p>
                        <p><strong>Esquadrão:</strong> 
                            <span class="esquadrao-badge ${badgeClass}">
                                ${horse.esquadrao}${horse.origem ? ` (${horse.origem})` : ''}
                            </span>
                        </p>
                        <p><strong>Protocolo:</strong> ${horse.protocolo || 'Nenhum'}</p>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 2V8H20" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 13H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 17H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 9H9H8" stroke="#2c7fb8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Histórico Médico
                    </h3>
                    <div class="timeline-section">
                        <div class="timeline-container">
            `;
            
            if (horse.history && horse.history.length > 0) {
                const sortedHistory = [...horse.history].sort((a, b) => {
                    const dateA = a.date.split('/').reverse().join('-');
                    const dateB = b.date.split('/').reverse().join('-');
                    return new Date(dateB) - new Date(dateA);
                });
                
                sortedHistory.forEach((item, index) => {
                    detailContent += `
                        <div class="timeline-item" data-history-index="${index}">
                            <div class="timeline-header">
                                <div class="timeline-date">${item.date}</div>
                                <button class="timeline-expand" data-history-index="${index}">+</button>
                            </div>
                        </div>
                    `;
                });
            } else {
                detailContent += `
                    <div class="timeline-item">
                        <div class="timeline-header">
                            <div class="timeline-date">Nenhum registro</div>
                        </div>
                    </div>
                `;
            }
            
            detailContent += `
                        </div>
                    </div>
                    
                    <button class="add-history-btn" id="addHistoryBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 12H19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Adicionar Novo Histórico
                    </button>
                    
                    <div class="history-edit-form" id="historyEditForm" style="display: ${isEditingHistory ? 'block' : 'none'};">
                        <h4>${isEditingHistory ? 'Editar Histórico' : 'Novo Registro de Histórico'}</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="historyDate">Data</label>
                                <input type="text" id="historyDate" placeholder="DD/MM/AAAA" value="${isEditingHistory ? horse.history[0].date : ''}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="historyDescription">Descrição</label>
                            <textarea id="historyDescription" rows="3" placeholder="Descreva o histórico médico...">${isEditingHistory ? horse.history[0].description : ''}</textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelHistory">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="saveHistory">Salvar Histórico</button>
                        </div>
                    </div>
                </div>
            `;
            
            horseDetailContent.innerHTML = detailContent;
            
            activeWindows.forEach(window => window.remove());
            activeWindows = [];
            
            horseDetailModal.style.display = 'flex';
        }
        
        function deleteHorse(horseId) {
            const horseIndex = horses.findIndex(h => h.id === horseId);
            if (horseIndex !== -1) {
                // Remover também registros de cólicas associados
                colicas = colicas.filter(c => c.horseId !== horseId);
                
                horses.splice(horseIndex, 1);
                
                saveHorsesToStorage();
                saveColicasToStorage();
                
                if (currentHorseId === horseId) {
                    closeHorseDetailModal();
                }
                
                renderHorses();
                renderColicas();
                renderColicaStats();
                initCharts();
                
                alert('Cavalo excluído permanentemente!');
            }
        }
        
        function openAddModal() {
            horseForm.reset();
            esquadraoOrigem.style.display = 'none';
            
            esquadraoOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            horseModal.style.display = 'flex';
        }
        
        function closeHorseModal() {
            horseModal.style.display = 'none';
        }
        
        function closeHorseDetailModal() {
            activeWindows.forEach(window => window.remove());
            activeWindows = [];
            
            horseDetailModal.style.display = 'none';
            isEditingHistory = false;
        }
        
        function saveHorse(e) {
            e.preventDefault();
            
            const horseName = document.getElementById('horseName').value;
            const horseId = horses.length > 0 ? Math.max(...horses.map(h => h.id)) + 1 : 1;
            const horseColor = document.getElementById('horseColor').value;
            const horseSex = document.getElementById('horseSex').value;
            const horseHistory = document.getElementById('horseHistory').value;
            
            let selectedEsquadrao = '';
            let origem = '';
            
            esquadraoOptions.forEach(option => {
                if (option.classList.contains('selected')) {
                    selectedEsquadrao = option.getAttribute('data-value');
                }
            });
            
            if (selectedEsquadrao === 'Outro') {
                origem = document.getElementById('horseOrigem').value;
                if (!origem) {
                    alert('Por favor, digite a origem do animal.');
                    return;
                }
            }
            
            if (!selectedEsquadrao) {
                alert('Por favor, selecione um esquadrão.');
                return;
            }
            
            const historyArray = [];
            if (horseHistory) {
                const lines = horseHistory.split('\n');
                lines.forEach(line => {
                    if (line.trim()) {
                        const dateMatch = line.match(/^(\d{2}\/\d{2}\/\d{4}):\s*(.*)/);
                        if (dateMatch) {
                            historyArray.push({
                                date: dateMatch[1],
                                description: dateMatch[2]
                            });
                        } else {
                            const today = new Date();
                            const formattedDate = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth()+1).toString().padStart(2, '0')}/${today.getFullYear()}`;
                            historyArray.push({
                                date: formattedDate,
                                description: line.trim()
                            });
                        }
                    }
                });
            }
            
            const horseData = {
                name: horseName,
                id: horseId,
                color: horseColor,
                sex: horseSex,
                esquadrao: selectedEsquadrao,
                origem: origem,
                history: historyArray,
                prescriptions: [],
                protocolo: "Quarentena",
                selectedForVisit: false
            };
            
            horses.push(horseData);
            
            saveHorsesToStorage();
            
            closeHorseModal();
            renderHorses();
            renderColicas();
            alert('Ficha salva com sucesso!');
        }
        
        function exportToPDF(horseId) {
            const horse = horses.find(h => h.id === horseId);
            if (!horse) return;
            
            alert(`Gerando PDF para ${horse.name}...\n\nEm um sistema real, isso geraria um arquivo PDF com todas as informações da ficha.`);
        }
        
        function exportAllToPDF() {
            alert('Exportando todas as fichas para PDF...\n\nEm um sistema real, isso geraria um arquivo ZIP com PDFs de todos os cavalos.');
        }
        
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userRole');
                showLoginPage();
            }
        }
        
        // ========== INICIALIZAÇÃO ==========
        function init() {
            if (!checkLogin()) {
                return;
            }
            
            currentUser = localStorage.getItem('currentUser');
            
            // Event Listeners da tela de arquivos
            btnAddHorse.addEventListener('click', openAddModal);
            btnExportAll.addEventListener('click', exportAllToPDF);
            closeModal.addEventListener('click', closeHorseModal);
            btnCancel.addEventListener('click', closeHorseModal);
            horseForm.addEventListener('submit', saveHorse);
            searchInput.addEventListener('input', renderHorses);
            btnLogout.addEventListener('click', logout);
            
            // Event Listeners do modal de detalhes
            closeDetailModal.addEventListener('click', closeHorseDetailModal);
            btnCloseDetail.addEventListener('click', closeHorseDetailModal);
            
            // Event Listener para o botão "Editar Ficha" no modal de detalhes
            btnEditHorse.addEventListener('click', () => {
                redirectToFicha(currentHorseId);
            });
            
            // Event Listener para excluir cavalo no modal de detalhes
            btnDeleteHorse.addEventListener('click', () => {
                showCustomConfirm(currentHorseId);
            });
            
            // Event Listeners para opções de esquadrão
            esquadraoOptions.forEach(option => {
                option.addEventListener('click', function() {
                    esquadraoOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    if (this.getAttribute('data-value') === 'Outro') {
                        esquadraoOrigem.style.display = 'block';
                    } else {
                        esquadraoOrigem.style.display = 'none';
                    }
                });
            });
            
            // Event Listeners para navegação entre abas
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Event Listeners para cólicas - CORREÇÃO AQUI
            btnNovaColica.addEventListener('click', openColicaModal);
            btnRelatorioColicas.addEventListener('click', gerarRelatorioColicas);
            closeColicaModalBtn.addEventListener('click', closeColicaModalFunc); // CORREÇÃO
            btnCancelColica.addEventListener('click', closeColicaModalFunc); // CORREÇÃO
            colicaForm.addEventListener('submit', saveColica);
            
            // Event Listeners para filtros de esquadrão
            esquadraoFilterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const esquadrao = this.getAttribute('data-esquadrao');
                    filterByEsquadrao(esquadrao);
                });
            });
            
            // Event Listeners para seleção de gravidade
            document.querySelectorAll('.severity-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.severity-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedSeverity = this.getAttribute('data-severity');
                });
            });
            
            // Event Listeners para seleção de tratamento
            document.querySelectorAll('.treatment-option').forEach(option => {
                option.addEventListener('click', function() {
                    const treatment = this.getAttribute('data-treatment');
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedTreatments = selectedTreatments.filter(t => t !== treatment);
                    } else {
                        this.classList.add('selected');
                        selectedTreatments.push(treatment);
                    }
                });
            });
            
            // Event Listeners para o balão de confirmação personalizado
            confirmCancelBtn.addEventListener('click', hideCustomConfirm);
            confirmDeleteBtn.addEventListener('click', confirmDelete);
            
            // Fechar balão de confirmação ao clicar fora
            customConfirmOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    hideCustomConfirm();
                }
            });
            
            // Fechar modais ao clicar fora deles
            window.addEventListener('click', (e) => {
                if (e.target === horseModal) {
                    closeHorseModal();
                }
                if (e.target === horseDetailModal) {
                    closeHorseDetailModal();
                }
                if (e.target === colicaModal) {
                    closeColicaModalFunc(); // CORREÇÃO
                }
            });
            
            // Iniciar a aplicação
            showWelcomePage();
        }
        
        // Iniciar a aplicação
        init();
    </script>
</body>
</html>
